<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Buyer Dashboard - AgroLink</title>
    <meta name="description" content="Manage your orders, track deliveries, and browse fresh produce on AgroLink.">
    <link rel="stylesheet" href="assets/css/style.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:ital,wght@0,100..900;1,100..900&display=swap" rel="stylesheet">
</head>
<body>
    <!-- Header -->
    <header class="header">
        <nav class="nav container">
            <div class="logo">
                <img src="assets/img/Logo.png" alt="AgroLink" style="height: 40px;">
            </div>
            <div class="nav-actions">
                <div class="user-info">
                    <span>Welcome, <span id="buyerName">Buyer</span></span>
                    <button onclick="logout()" class="btn btn-sm">Logout</button>
                </div>
            </div>
        </nav>
    </header>

    <!-- Dashboard Layout -->
    <div class="dashboard">
        <!-- Sidebar -->
        <aside class="sidebar">
            <h3 style="margin-bottom: var(--spacing-lg); color: var(--primary-green);">üõí Buyer Dashboard</h3>
            <ul class="sidebar-menu">
                <li><a href="#overview" class="menu-link active" data-section="overview">üìä Overview</a></li>
                <li><a href="#profile" class="menu-link" data-section="profile">üë§ Profile</a></li>
                <li><a href="#products" class="menu-link" data-section="products">üõçÔ∏è Browse Products</a></li>
                <li><a href="#orders" class="menu-link" data-section="orders">üì¶ My Orders</a></li>
                <li><a href="#tracking" class="menu-link" data-section="tracking">üöö Order Tracking</a></li>
                <li><a href="#wishlist" class="menu-link" data-section="wishlist">‚ù§Ô∏è Wishlist</a></li>
                <li><a href="#cart" class="menu-link" data-section="cart">üõí Cart</a></li>
                <li><a href="#requests" class="menu-link" data-section="requests">üå± Crop Requests</a></li>
                <li><a href="#reviews" class="menu-link" data-section="reviews">‚≠ê Reviews</a></li>
                <li><a href="#notifications" class="menu-link" data-section="notifications">üîî Notifications</a></li>
            </ul>
        </aside>

        <!-- Main Content -->
        <main class="main-content">
            <!-- Overview Section -->
            <div id="overview-section" class="content-section">
                <h1 style="margin-bottom: var(--spacing-lg);">Dashboard Overview</h1>
                
                <div class="dashboard-stats">
                    <div class="stat-card">
                        <div class="stat-number" id="totalOrders">8</div>
                        <div class="stat-label">Total Orders</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="pendingOrders">3</div>
                        <div class="stat-label">Pending Orders</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="totalSpent">Rs. 2,340</div>
                        <div class="stat-label">Total Spent</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="wishlistItems">5</div>
                        <div class="stat-label">Wishlist Items</div>
                    </div>
                </div>

                <!-- Recent Orders -->
                <div class="card" style="margin-top: var(--spacing-xl);">
                    <div style="padding: var(--spacing-lg); border-bottom: 1px solid var(--medium-gray);">
                        <h3>üì¶ Recent Orders</h3>
                    </div>
                    <div style="padding: var(--spacing-lg);">
                        <div class="order-card" data-status="delivered">
                            <div class="order-header">
                                <h4 class="order-title">Order #1001</h4>
                                <div class="order-status delivered">Delivered</div>
                            </div>
                            <div class="order-details">
                                <div class="order-detail">
                                    <span class="detail-label">Product</span>
                                    <span class="detail-value">Fresh Tomatoes</span>
                                </div>
                                <div class="order-detail">
                                    <span class="detail-label">Quantity</span>
                                    <span class="detail-value">2kg</span>
                                </div>
                                <div class="order-detail">
                                    <span class="detail-label">Farmer</span>
                                    <span class="detail-value">Ranjith Fernando</span>
                                </div>
                                <div class="order-detail">
                                    <span class="detail-label">Total</span>
                                    <span class="detail-value">Rs. 240</span>
                                </div>
                                <div class="order-detail">
                                    <span class="detail-label">Date</span>
                                    <span class="detail-value">Aug 15, 2025</span>
                                </div>
                            </div>
                            <div class="order-actions">
                                <button class="btn btn-secondary">View Details</button>
                                <button class="btn btn-primary">Reorder</button>
                                <button class="btn btn-outline">Rate & Review</button>
                            </div>
                        </div>

                        <div class="order-card" data-status="pending">
                            <div class="order-header">
                                <h4 class="order-title">Order #1002</h4>
                                <div class="order-status pending">Pending</div>
                            </div>
                            <div class="order-details">
                                <div class="order-detail">
                                    <span class="detail-label">Product</span>
                                    <span class="detail-value">Green Beans</span>
                                </div>
                                <div class="order-detail">
                                    <span class="detail-label">Quantity</span>
                                    <span class="detail-value">1kg</span>
                                </div>
                                <div class="order-detail">
                                    <span class="detail-label">Farmer</span>
                                    <span class="detail-value">Kumari Silva</span>
                                </div>
                                <div class="order-detail">
                                    <span class="detail-label">Total</span>
                                    <span class="detail-value">Rs. 180</span>
                                </div>
                                <div class="order-detail">
                                    <span class="detail-label">Date</span>
                                    <span class="detail-value">Aug 18, 2025</span>
                                </div>
                            </div>
                            <div class="order-actions">
                                <button class="btn btn-secondary">View Details</button>
                                <button class="btn btn-danger">Cancel Order</button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Quick Actions -->
                <div class="card" style="margin-top: var(--spacing-xl);">
                    <div style="padding: var(--spacing-lg); border-bottom: 1px solid var(--medium-gray);">
                        <h3>‚ö° Quick Actions</h3>
                    </div>
                    <div style="padding: var(--spacing-lg);">
                        <div class="grid grid-4">
                            <button class="btn btn-primary" onclick="showSection('products')">üõçÔ∏è Browse Products</button>
                            <button class="btn btn-secondary" onclick="showSection('orders')">üì¶ View Orders</button>
                            <button class="btn btn-secondary" onclick="showSection('cart')">üõí View Cart</button>
                            <button class="btn btn-secondary" onclick="showSection('profile')">üë§ Update Profile</button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Orders Section -->
            <div id="orders-section" class="content-section" style="display: none;">
                <h1 style="margin-bottom: var(--spacing-lg);">My Orders</h1>
                
                <div class="card" style="margin-bottom: var(--spacing-lg);">
                    <div style="padding: var(--spacing-lg); border-bottom: 1px solid var(--medium-gray);">
                        <h3>Filter Orders</h3>
                    </div>
                    <div style="padding: var(--spacing-lg);">
                        <div class="grid grid-4">
                            <div class="form-group">
                                <label for="orderSearch">Search Orders</label>
                                <input type="text" id="orderSearch" class="form-control" placeholder="Search by product or order ID...">
                            </div>
                            <div class="form-group">
                                <label for="statusFilter">Order Status</label>
                                <select id="statusFilter" class="form-control">
                                    <option value="">All Statuses</option>
                                    <option value="pending">Pending</option>
                                    <option value="shipped">Shipped</option>
                                    <option value="delivered">Delivered</option>
                                    <option value="cancelled">Cancelled</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="dateFilter">Order Date</label>
                                <input type="date" id="dateFilter" class="form-control">
                            </div>
                            <div class="form-group">
                                <label for="farmerFilter">Farmer</label>
                                <input type="text" id="farmerFilter" class="form-control" placeholder="Filter by farmer name...">
                            </div>
                        </div>
                    </div>
                </div>

                <div id="ordersContainer">
                    <!-- Orders will be dynamically loaded here -->
                </div>
            </div>

            <!-- Wishlist Section -->
            <div id="wishlist-section" class="content-section" style="display: none;">
                <h1 style="margin-bottom: var(--spacing-lg);">My Wishlist</h1>
                
                <div class="grid grid-3">
                    <div class="card">
                        <div style="text-align: center; padding: var(--spacing-lg);">
                            <div style="font-size: 3rem; margin-bottom: var(--spacing-md);">ü•≠</div>
                            <h4>Sweet Mangoes</h4>
                            <p class="text-muted">Pradeep Jayasinghe (Galle)</p>
                            <div style="font-size: 1.25rem; font-weight: bold; color: var(--primary-green); margin: var(--spacing-md) 0;">Rs. 150/kg</div>
                            <button class="btn btn-primary w-full">Add to Cart</button>
                            <button class="btn btn-outline w-full mt-sm">Remove from Wishlist</button>
                        </div>
                    </div>

                    <div class="card">
                        <div style="text-align: center; padding: var(--spacing-lg);">
                            <div style="font-size: 3rem; margin-bottom: var(--spacing-md);">üåæ</div>
                            <h4>Red Rice</h4>
                            <p class="text-muted">Sunil Perera (Anuradhapura)</p>
                            <div style="font-size: 1.25rem; font-weight: bold; color: var(--primary-green); margin: var(--spacing-md) 0;">Rs. 95/kg</div>
                            <button class="btn btn-primary w-full">Add to Cart</button>
                            <button class="btn btn-outline w-full mt-sm">Remove from Wishlist</button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Cart Section -->
            <div id="cart-section" class="content-section" style="display: none;">
                <h1 style="margin-bottom: var(--spacing-lg);">Shopping Cart</h1>
                
                <div class="grid grid-2">
                    <div>
                        <div class="card">
                            <div style="text-align: center; padding: var(--spacing-lg);">
                                <div style="font-size: 3rem; margin-bottom: var(--spacing-md);">üçÖ</div>
                                <h4>Fresh Tomatoes</h4>
                                <p class="text-muted">Ranjith Fernando (Matale)</p>
                                <div style="display: flex; justify-content: space-between; align-items: center; margin: var(--spacing-md) 0;">
                                    <span>Quantity: 2kg</span>
                                    <div style="font-size: 1.25rem; font-weight: bold; color: var(--primary-green);">Rs. 240</div>
                                </div>
                                <button class="btn btn-danger w-full">Remove from Cart</button>
                            </div>
                        </div>
                    </div>
                    
                    <div>
                        <div class="card" style="background: var(--primary-green); color: var(--white);">
                            <div style="padding: var(--spacing-xl); text-align: center;">
                                <div style="font-size: 2rem; font-weight: bold; margin-bottom: var(--spacing-lg);">Total: Rs. 240</div>
                                <button class="btn btn-secondary btn-large">Continue Shopping</button>
                                <button class="btn btn-primary btn-large">Proceed to Checkout</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Profile Section -->
            <div id="profile-section" class="content-section" style="display: none;">
                <h1 style="margin-bottom: var(--spacing-lg);">üë§ Profile & Settings</h1>
                
                <!-- Profile Information -->
                <div class="card" style="margin-bottom: var(--spacing-lg);">
                    <div style="padding: var(--spacing-lg); border-bottom: 1px solid var(--medium-gray);">
                        <h3>Personal Information</h3>
                    </div>
                    <div style="padding: var(--spacing-lg);">
                        <div class="grid grid-2">
                            <div class="form-group">
                                <label for="profileName">Full Name</label>
                                <input type="text" id="profileName" class="form-control" value="Duleeka Rathnayake">
                            </div>
                            <div class="form-group">
                                <label for="profileEmail">Email Address</label>
                                <input type="email" id="profileEmail" class="form-control" value="duleeka@restaurant.com" readonly>
                            </div>
                            <div class="form-group">
                                <label for="profilePhone">Phone Number</label>
                                <input type="tel" id="profilePhone" class="form-control" value="+94 71 234 5678">
                            </div>
                            <div class="form-group">
                                <label for="profileLocation">Location</label>
                                <input type="text" id="profileLocation" class="form-control" value="Colombo">
                            </div>
                            <div class="form-group">
                                <label for="profileBusiness">Business Name</label>
                                <input type="text" id="profileBusiness" class="form-control" value="Green Leaf Restaurant">
                            </div>
                            <div class="form-group">
                                <label for="profileType">Business Type</label>
                                <select id="profileType" class="form-control">
                                    <option value="restaurant" selected>Restaurant</option>
                                    <option value="hotel">Hotel</option>
                                    <option value="catering">Catering Service</option>
                                    <option value="retail">Retail Store</option>
                                    <option value="wholesale">Wholesale Buyer</option>
                                    <option value="individual">Individual Consumer</option>
                                </select>
                            </div>
                        </div>
                        <div class="form-group" style="margin-top: var(--spacing-md);">
                            <label for="profileAddress">Delivery Address</label>
                            <textarea id="profileAddress" class="form-control" rows="3">123 Main Street, Colombo 03, Western Province, Sri Lanka</textarea>
                        </div>
                        <div style="margin-top: var(--spacing-lg);">
                            <button class="btn btn-primary" onclick="updateProfile()">Update Profile</button>
                            <button class="btn btn-secondary" onclick="resetProfile()">Reset Changes</button>
                        </div>
                    </div>
                </div>

                <!-- Account Settings -->
                <div class="card" style="margin-bottom: var(--spacing-lg);">
                    <div style="padding: var(--spacing-lg); border-bottom: 1px solid var(--medium-gray);">
                        <h3>Account Settings</h3>
                    </div>
                    <div style="padding: var(--spacing-lg);">
                        <div class="grid grid-2">
                            <div class="form-group">
                                <label for="currentPassword">Current Password</label>
                                <input type="password" id="currentPassword" class="form-control" placeholder="Enter current password">
                            </div>
                            <div class="form-group">
                                <label for="newPassword">New Password</label>
                                <input type="password" id="newPassword" class="form-control" placeholder="Enter new password">
                            </div>
                        </div>
                        <div class="form-group" style="margin-top: var(--spacing-md);">
                            <label for="confirmPassword">Confirm New Password</label>
                            <input type="password" id="confirmPassword" class="form-control" placeholder="Confirm new password">
                        </div>
                        <div style="margin-top: var(--spacing-lg);">
                            <button class="btn btn-primary" onclick="changePassword()">Change Password</button>
                        </div>
                    </div>
                </div>

                <!-- Preferences -->
                <div class="card" style="margin-bottom: var(--spacing-lg);">
                    <div style="padding: var(--spacing-lg); border-bottom: 1px solid var(--medium-gray);">
                        <h3>Preferences & Notifications</h3>
                    </div>
                    <div style="padding: var(--spacing-lg);">
                        <div class="grid grid-2">
                            <div>
                                <h4 style="margin-bottom: var(--spacing-md);">Notification Settings</h4>
                                <div class="form-group">
                                    <label class="checkbox-label">
                                        <input type="checkbox" id="emailNotifications" checked>
                                        <span class="checkmark"></span>
                                        Email Notifications
                                    </label>
                                </div>
                                <div class="form-group">
                                    <label class="checkbox-label">
                                        <input type="checkbox" id="smsNotifications">
                                        <span class="checkmark"></span>
                                        SMS Notifications
                                    </label>
                                </div>
                                <div class="form-group">
                                    <label class="checkbox-label">
                                        <input type="checkbox" id="orderUpdates" checked>
                                        <span class="checkmark"></span>
                                        Order Status Updates
                                    </label>
                                </div>
                                <div class="form-group">
                                    <label class="checkbox-label">
                                        <input type="checkbox" id="priceAlerts" checked>
                                        <span class="checkmark"></span>
                                        Price Drop Alerts
                                    </label>
                                </div>
                                <div class="form-group">
                                    <label class="checkbox-label">
                                        <input type="checkbox" id="newProducts">
                                        <span class="checkmark"></span>
                                        New Product Notifications
                                    </label>
                                </div>
                            </div>
                            <div>
                                <h4 style="margin-bottom: var(--spacing-md);">Delivery Preferences</h4>
                                <div class="form-group">
                                    <label for="preferredTime">Preferred Delivery Time</label>
                                    <select id="preferredTime" class="form-control">
                                        <option value="morning">Morning (8 AM - 12 PM)</option>
                                        <option value="afternoon" selected>Afternoon (12 PM - 4 PM)</option>
                                        <option value="evening">Evening (4 PM - 8 PM)</option>
                                        <option value="anytime">Anytime</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label for="deliveryRadius">Maximum Delivery Distance</label>
                                    <select id="deliveryRadius" class="form-control">
                                        <option value="10">10 km</option>
                                        <option value="25" selected>25 km</option>
                                        <option value="50">50 km</option>
                                        <option value="100">100 km</option>
                                        <option value="any">Any distance</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label class="checkbox-label">
                                        <input type="checkbox" id="contactlessDelivery" checked>
                                        <span class="checkmark"></span>
                                        Prefer Contactless Delivery
                                    </label>
                                </div>
                                <div class="form-group">
                                    <label for="specialInstructions">Special Delivery Instructions</label>
                                    <textarea id="specialInstructions" class="form-control" rows="3" placeholder="Any special instructions for delivery...">Please call 10 minutes before arrival</textarea>
                                </div>
                            </div>
                        </div>
                        <div style="margin-top: var(--spacing-lg);">
                            <button class="btn btn-primary" onclick="savePreferences()">Save Preferences</button>
                        </div>
                    </div>
                </div>

                <!-- Account Statistics -->
                <div class="card" style="margin-bottom: var(--spacing-lg);">
                    <div style="padding: var(--spacing-lg); border-bottom: 1px solid var(--medium-gray);">
                        <h3>Account Statistics</h3>
                    </div>
                    <div style="padding: var(--spacing-lg);">
                        <div class="grid grid-4">
                            <div style="text-align: center; padding: var(--spacing-md);">
                                <div style="font-size: 2rem; font-weight: bold; color: var(--primary-green);">8</div>
                                <div style="color: var(--dark-gray);">Total Orders</div>
                            </div>
                            <div style="text-align: center; padding: var(--spacing-md);">
                                <div style="font-size: 2rem; font-weight: bold; color: var(--primary-green);">Rs. 2,340</div>
                                <div style="color: var(--dark-gray);">Total Spent</div>
                            </div>
                            <div style="text-align: center; padding: var(--spacing-md);">
                                <div style="font-size: 2rem; font-weight: bold; color: var(--primary-green);">15</div>
                                <div style="color: var(--dark-gray);">Reviews Given</div>
                            </div>
                            <div style="text-align: center; padding: var(--spacing-md);">
                                <div style="font-size: 2rem; font-weight: bold; color: var(--primary-green);">6</div>
                                <div style="color: var(--dark-gray);">Favorite Farmers</div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Account Actions -->
                <div class="card">
                    <div style="padding: var(--spacing-lg); border-bottom: 1px solid var(--medium-gray);">
                        <h3>Account Actions</h3>
                    </div>
                    <div style="padding: var(--spacing-lg);">
                        <div class="grid grid-2">
                            <div>
                                <h4 style="margin-bottom: var(--spacing-md);">Data & Privacy</h4>
                                <button class="btn btn-secondary" onclick="downloadData()">üì• Download My Data</button>
                                <button class="btn btn-secondary" onclick="exportOrders()">üìä Export Order History</button>
                                <button class="btn btn-outline" onclick="viewPrivacyPolicy()">üîí Privacy Policy</button>
                            </div>
                            <div>
                                <h4 style="margin-bottom: var(--spacing-md);">Account Management</h4>
                                <button class="btn btn-outline" onclick="deactivateAccount()">‚è∏Ô∏è Deactivate Account</button>
                                <button class="btn btn-danger" onclick="deleteAccount()">üóëÔ∏è Delete Account</button>
                                <button class="btn btn-outline" onclick="contactSupport()">üí¨ Contact Support</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Products Section -->
            <div id="products-section" class="content-section" style="display: none;">
                <h1 style="margin-bottom: var(--spacing-lg);">üõçÔ∏è Browse Products</h1>
                
                <!-- Product Filters -->
                <div class="card" style="margin-bottom: var(--spacing-lg);">
                    <div style="padding: var(--spacing-lg); border-bottom: 1px solid var(--medium-gray);">
                        <h3>Filter Products</h3>
                    </div>
                    <div style="padding: var(--spacing-lg);">
                        <div class="grid grid-4">
                            <div class="form-group">
                                <label for="productSearch">Search Products</label>
                                <input type="text" id="productSearch" class="form-control" placeholder="Search by name or farmer...">
                            </div>
                            <div class="form-group">
                                <label for="categoryFilter">Category</label>
                                <select id="categoryFilter" class="form-control">
                                    <option value="">All Categories</option>
                                    <option value="vegetables">ü•¨ Vegetables</option>
                                    <option value="fruits">üçé Fruits</option>
                                    <option value="grains">üåæ Grains</option>
                                    <option value="spices">üå∂Ô∏è Spices</option>
                                    <option value="herbs">üåø Herbs</option>
                                    <option value="legumes">ü´ò Legumes</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="locationFilter">Location</label>
                                <select id="locationFilter" class="form-control">
                                    <option value="">All Locations</option>
                                    <option value="Colombo">Colombo</option>
                                    <option value="Kandy">Kandy</option>
                                    <option value="Galle">Galle</option>
                                    <option value="Matale">Matale</option>
                                    <option value="Anuradhapura">Anuradhapura</option>
                                    <option value="Nuwara Eliya">Nuwara Eliya</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="priceFilter">Price Range</label>
                                <select id="priceFilter" class="form-control">
                                    <option value="">All Prices</option>
                                    <option value="0-100">Under Rs. 100</option>
                                    <option value="100-200">Rs. 100 - 200</option>
                                    <option value="200-500">Rs. 200 - 500</option>
                                    <option value="500+">Above Rs. 500</option>
                                </select>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Products Grid -->
                <div id="productsGrid" class="grid grid-3">
                    <!-- Products will be dynamically loaded here -->
                </div>
            </div>

            <!-- Tracking Section -->
            <div id="tracking-section" class="content-section" style="display: none;">
                <h1 style="margin-bottom: var(--spacing-lg);">Order Tracking</h1>
                <div class="card">
                    <div style="padding: var(--spacing-lg);">
                        <p>Order tracking section will be added here.</p>
                    </div>
                </div>
            </div>

            <!-- Requests Section -->
            <div id="requests-section" class="content-section" style="display: none;">
                <h1 style="margin-bottom: var(--spacing-lg);">Crop Requests</h1>
                <div class="card">
                    <div style="padding: var(--spacing-lg);">
                        <p>Crop requests section will be added here.</p>
                    </div>
                </div>
            </div>

            <!-- Reviews Section -->
            <div id="reviews-section" class="content-section" style="display: none;">
                <h1 style="margin-bottom: var(--spacing-lg);">Reviews</h1>
                <div class="card">
                    <div style="padding: var(--spacing-lg);">
                        <p>Reviews section will be added here.</p>
                    </div>
                </div>
            </div>

            <!-- Notifications Section -->
            <div id="notifications-section" class="content-section" style="display: none;">
                <h1 style="margin-bottom: var(--spacing-lg);">Notifications</h1>
                <div class="card">
                    <div style="padding: var(--spacing-lg);">
                        <p>Notifications section will be added here.</p>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <style>
        /* Custom checkbox styles */
        .checkbox-label {
            display: flex;
            align-items: center;
            cursor: pointer;
            margin-bottom: var(--spacing-sm);
            font-size: 0.9rem;
        }

        .checkbox-label input[type="checkbox"] {
            margin-right: var(--spacing-sm);
            width: 16px;
            height: 16px;
            cursor: pointer;
        }

        .checkbox-label:hover {
            color: var(--primary-green);
        }
    </style>

    <script>
        // Dashboard functionality
        function showSection(sectionName) {
            // Hide all sections
            const sections = document.querySelectorAll('.content-section');
            sections.forEach(section => {
                section.style.display = 'none';
            });

            // Show selected section
            const targetSection = document.getElementById(sectionName + '-section');
            if (targetSection) {
                targetSection.style.display = 'block';
            }

            // Update active menu item
            const menuLinks = document.querySelectorAll('.menu-link');
            menuLinks.forEach(link => {
                link.classList.remove('active');
                if (link.getAttribute('data-section') === sectionName) {
                    link.classList.add('active');
                }
            });

            // Load section-specific data
            switch(sectionName) {
                case 'orders':
                    loadOrders();
                    break;
                case 'wishlist':
                    loadWishlist();
                    break;
                case 'cart':
                    loadCart();
                    break;
                case 'products':
                    loadProducts();
                    break;
                case 'tracking':
                    loadTracking();
                    break;
                case 'reviews':
                    loadReviews();
                    break;
                case 'notifications':
                    loadNotifications();
                    break;
            }
        }

        function logout() {
            if (confirm('Are you sure you want to logout?')) {
                // Clear localStorage
                localStorage.removeItem('user_id');
                localStorage.removeItem('user_email');
                localStorage.removeItem('user_role');
                localStorage.removeItem('user_name');
                localStorage.removeItem('business_name');
                localStorage.removeItem('buyerCart');
                localStorage.removeItem('buyerWishlist');
                
                // Redirect to logout handler
                window.location.href = 'auth/logout.php';
            }
        }

        function clearCart() {
            if (confirm('Are you sure you want to clear your cart?')) {
                localStorage.removeItem('buyerCart');
                loadCart();
                showNotification('Cart cleared successfully!', 'success');
            }
        }

        function showNotification(message, type) {
            // Create notification element
            const notification = document.createElement('div');
            notification.className = `notification ${type}`;
            notification.textContent = message;
            
            // Style the notification
            Object.assign(notification.style, {
                position: 'fixed',
                top: '20px',
                right: '20px',
                padding: '1rem 2rem',
                borderRadius: '8px',
                color: 'white',
                backgroundColor: type === 'success' ? '#10b981' : type === 'warning' ? '#f59e0b' : type === 'error' ? '#ef4444' : '#3b82f6',
                zIndex: '1000',
                fontSize: '14px',
                fontWeight: 'bold',
                boxShadow: '0 4px 6px rgba(0, 0, 0, 0.1)'
            });
            
            document.body.appendChild(notification);
            
            // Remove after 3 seconds
            setTimeout(() => {
                notification.remove();
            }, 3000);
        }

        // Load dashboard overview data
        function loadDashboardData() {
            // Mock data - in real app, fetch from APIs
            document.getElementById('totalOrders').textContent = '8';
            document.getElementById('pendingOrders').textContent = '3';
            document.getElementById('totalSpent').textContent = 'Rs. 2,340';
            document.getElementById('wishlistItems').textContent = '5';
            
            // Load recent orders
            loadRecentOrders();
        }

        // Load recent orders for overview
        function loadRecentOrders() {
            const recentOrdersContainer = document.querySelector('#overview-section .card .order-card');
            if (recentOrdersContainer) {
                // Recent orders are already in HTML, just update if needed
                updateOrderStatuses();
            }
        }

        // Load orders data
        function loadOrders() {
            const ordersContainer = document.getElementById('ordersContainer');
            if (!ordersContainer) return;

            ordersContainer.innerHTML = `
                <div class="order-card" data-status="delivered">
                    <div class="order-header">
                        <h4 class="order-title">Order #1001</h4>
                        <div class="order-status delivered">Delivered</div>
                    </div>
                    <div class="order-details">
                        <div class="order-detail">
                            <span class="detail-label">Product</span>
                            <span class="detail-value">Fresh Tomatoes</span>
                        </div>
                        <div class="order-detail">
                            <span class="detail-label">Quantity</span>
                            <span class="detail-value">2kg</span>
                        </div>
                        <div class="order-detail">
                            <span class="detail-label">Farmer</span>
                            <span class="detail-value">Ranjith Fernando</span>
                        </div>
                        <div class="order-detail">
                            <span class="detail-label">Total</span>
                            <span class="detail-value">Rs. 240</span>
                        </div>
                        <div class="order-detail">
                            <span class="detail-label">Date</span>
                            <span class="detail-value">Aug 15, 2025</span>
                        </div>
                    </div>
                    <div class="order-actions">
                        <button class="btn btn-secondary" onclick="viewOrderDetails('1001')">View Details</button>
                        <button class="btn btn-primary" onclick="reorder('1001')">Reorder</button>
                        <button class="btn btn-outline" onclick="rateOrder('1001')">Rate & Review</button>
                    </div>
                </div>

                <div class="order-card" data-status="pending">
                    <div class="order-header">
                        <h4 class="order-title">Order #1002</h4>
                        <div class="order-status pending">Pending</div>
                    </div>
                    <div class="order-details">
                        <div class="order-detail">
                            <span class="detail-label">Product</span>
                            <span class="detail-value">Green Beans</span>
                        </div>
                        <div class="order-detail">
                            <span class="detail-label">Quantity</span>
                            <span class="detail-value">1kg</span>
                        </div>
                        <div class="order-detail">
                            <span class="detail-label">Farmer</span>
                            <span class="detail-value">Kumari Silva</span>
                        </div>
                        <div class="order-detail">
                            <span class="detail-label">Total</span>
                            <span class="detail-value">Rs. 180</span>
                        </div>
                        <div class="order-detail">
                            <span class="detail-label">Date</span>
                            <span class="detail-value">Aug 18, 2025</span>
                        </div>
                    </div>
                    <div class="order-actions">
                        <button class="btn btn-secondary" onclick="viewOrderDetails('1002')">View Details</button>
                        <button class="btn btn-danger" onclick="cancelOrder('1002')">Cancel Order</button>
                    </div>
                </div>

                <div class="order-card" data-status="shipped">
                    <div class="order-header">
                        <h4 class="order-title">Order #1003</h4>
                        <div class="order-status shipped">Shipped</div>
                    </div>
                    <div class="order-details">
                        <div class="order-detail">
                            <span class="detail-label">Product</span>
                            <span class="detail-value">Sweet Mangoes</span>
                        </div>
                        <div class="order-detail">
                            <span class="detail-label">Quantity</span>
                            <span class="detail-value">3kg</span>
                        </div>
                        <div class="order-detail">
                            <span class="detail-label">Farmer</span>
                            <span class="detail-value">Pradeep Jayasinghe</span>
                        </div>
                        <div class="order-detail">
                            <span class="detail-label">Total</span>
                            <span class="detail-value">Rs. 450</span>
                        </div>
                        <div class="order-detail">
                            <span class="detail-label">Date</span>
                            <span class="detail-value">Aug 19, 2025</span>
                        </div>
                    </div>
                    <div class="order-actions">
                        <button class="btn btn-secondary" onclick="viewOrderDetails('1003')">View Order Details</button>
                        <button class="btn btn-primary" onclick="trackOrder('1003')">Track Order</button>
                    </div>
                </div>
            `;
        }

        // Load wishlist data
        function loadWishlist() {
            const wishlistContainer = document.querySelector('#wishlist-section .grid');
            if (!wishlistContainer) return;

            wishlistContainer.innerHTML = `
                <div class="card">
                    <div style="text-align: center; padding: var(--spacing-lg);">
                        <div style="font-size: 3rem; margin-bottom: var(--spacing-md);">ü•≠</div>
                        <h4>Sweet Mangoes</h4>
                        <p class="text-muted">Pradeep Jayasinghe (Galle)</p>
                        <div style="font-size: 1.25rem; font-weight: bold; color: var(--primary-green); margin: var(--spacing-md) 0;">Rs. 150/kg</div>
                        <button class="btn btn-primary w-full" onclick="addToCart('mangoes', 1)">Add to Cart</button>
                        <button class="btn btn-outline w-full mt-sm" onclick="removeFromWishlist('mangoes')">Remove from Wishlist</button>
                    </div>
                </div>

                <div class="card">
                    <div style="text-align: center; padding: var(--spacing-lg);">
                        <div style="font-size: 3rem; margin-bottom: var(--spacing-md);">üåæ</div>
                        <h4>Red Rice</h4>
                        <p class="text-muted">Sunil Perera (Anuradhapura)</p>
                        <div style="font-size: 1.25rem; font-weight: bold; color: var(--primary-green); margin: var(--spacing-md) 0;">Rs. 95/kg</div>
                        <button class="btn btn-primary w-full" onclick="addToCart('red-rice', 1)">Add to Cart</button>
                        <button class="btn btn-outline w-full mt-sm" onclick="removeFromWishlist('red-rice')">Remove from Wishlist</button>
                    </div>
                </div>

                <div class="card">
                    <div style="text-align: center; padding: var(--spacing-lg);">
                        <div style="font-size: 3rem; margin-bottom: var(--spacing-md);">ü•ï</div>
                        <h4>Organic Carrots</h4>
                        <p class="text-muted">Lakshmi Perera (Nuwara Eliya)</p>
                        <div style="font-size: 1.25rem; font-weight: bold; color: var(--primary-green); margin: var(--spacing-md) 0;">Rs. 120/kg</div>
                        <button class="btn btn-primary w-full" onclick="addToCart('carrots', 1)">Add to Cart</button>
                        <button class="btn btn-outline w-full mt-sm" onclick="removeFromWishlist('carrots')">Remove from Wishlist</button>
                    </div>
                </div>
            `;
        }

        // Load cart data
        function loadCart() {
            const cartContainer = document.querySelector('#cart-section .grid');
            if (!cartContainer) return;

            const cart = JSON.parse(localStorage.getItem('buyerCart')) || [];
            
            if (cart.length === 0) {
                cartContainer.innerHTML = `
                    <div class="card" style="text-align: center; padding: var(--spacing-xl);">
                        <div style="font-size: 4rem; margin-bottom: var(--spacing-md);">üõí</div>
                        <h3>Your cart is empty</h3>
                        <p class="text-muted">Add some products to get started!</p>
                        <button class="btn btn-primary" onclick="showSection('products')">Browse Products</button>
                    </div>
                `;
                return;
            }

            let cartTotal = 0;
            let cartItemsHTML = '';

            cart.forEach(item => {
                cartTotal += item.price * item.quantity;
                cartItemsHTML += `
                    <div class="card">
                        <div style="text-align: center; padding: var(--spacing-lg);">
                            <div style="font-size: 3rem; margin-bottom: var(--spacing-md);">${item.icon}</div>
                            <h4>${item.name}</h4>
                            <p class="text-muted">${item.farmer}</p>
                            <div style="display: flex; justify-content: space-between; align-items: center; margin: var(--spacing-md) 0;">
                                <span>Quantity: ${item.quantity}kg</span>
                                <div style="font-size: 1.25rem; font-weight: bold; color: var(--primary-green);">Rs. ${item.price * item.quantity}</div>
                            </div>
                            <div style="display: flex; gap: var(--spacing-sm); margin-bottom: var(--spacing-sm);">
                                <button class="btn btn-sm" onclick="updateQuantity('${item.id}', ${item.quantity - 1})">-</button>
                                <span style="padding: 0 var(--spacing-sm);">${item.quantity}</span>
                                <button class="btn btn-sm" onclick="updateQuantity('${item.id}', ${item.quantity + 1})">+</button>
                            </div>
                            <button class="btn btn-danger w-full" onclick="removeFromCart('${item.id}')">Remove from Cart</button>
                        </div>
                    </div>
                `;
            });

            cartContainer.innerHTML = `
                <div>
                    ${cartItemsHTML}
                </div>
                
                <div>
                    <div class="card" style="background: var(--primary-green); color: var(--white);">
                        <div style="padding: var(--spacing-xl); text-align: center;">
                            <div style="font-size: 2rem; font-weight: bold; margin-bottom: var(--spacing-lg);">Total: Rs. ${cartTotal}</div>
                            <button class="btn btn-secondary btn-large" onclick="showSection('products')">Continue Shopping</button>
                            <button class="btn btn-primary btn-large" onclick="proceedToCheckout()">Proceed to Checkout</button>
                        </div>
                    </div>
                </div>
            `;
        }

        // Load products data
        function loadProducts() {
            const productsGrid = document.getElementById('productsGrid');
            if (!productsGrid) return;

            // Comprehensive product data (from products.html)
            const products = [
                {
                    id: '1',
                    name: 'Fresh Tomatoes',
                    price: 120,
                    image: 'üçÖ',
                    farmer: 'Ranjith Fernando',
                    location: 'Matale',
                    category: 'vegetables',
                    description: 'Fresh organic tomatoes grown in Matale. Perfect for cooking and salads.',
                    organic: true,
                    available: true
                },
                {
                    id: '2',
                    name: 'Green Beans',
                    price: 180,
                    image: 'ü´õ',
                    farmer: 'Kumari Silva',
                    location: 'Kandy',
                    category: 'vegetables',
                    description: 'Premium quality green beans, freshly harvested and ready for delivery.',
                    available: true
                },
                {
                    id: '3',
                    name: 'Red Rice',
                    price: 95,
                    image: 'üåæ',
                    farmer: 'Sunil Perera',
                    location: 'Anuradhapura',
                    category: 'grains',
                    description: 'Traditional red rice variety, rich in nutrients and perfect for healthy meals.',
                    organic: true,
                    available: true
                },
                {
                    id: '4',
                    name: 'Sweet Mangoes',
                    price: 150,
                    image: 'ü•≠',
                    farmer: 'Pradeep Jayasinghe',
                    location: 'Galle',
                    category: 'fruits',
                    description: 'Juicy and sweet mangoes from Galle region, perfect ripeness guaranteed.',
                    available: true
                },
                {
                    id: '5',
                    name: 'Fresh Carrots',
                    price: 200,
                    image: 'ü•ï',
                    farmer: 'Manjula Rathnayake',
                    location: 'Nuwara Eliya',
                    category: 'vegetables',
                    description: 'Fresh carrots from the cool climate of Nuwara Eliya, sweet and crunchy.',
                    organic: true,
                    available: true
                },
                {
                    id: '6',
                    name: 'Red Chili Powder',
                    price: 800,
                    image: 'üå∂Ô∏è',
                    farmer: 'Gamini Wickramasinghe',
                    location: 'Matale',
                    category: 'spices',
                    description: 'Premium quality red chili powder, perfectly ground and spiced.',
                    limited: true
                },
                {
                    id: '7',
                    name: 'Ripe Bananas',
                    price: 80,
                    image: 'üçå',
                    farmer: 'Asanka Perera',
                    location: 'Ratnapura',
                    category: 'fruits',
                    description: 'Sweet and ripe bananas, perfect for eating fresh or cooking.',
                    available: true
                },
                {
                    id: '8',
                    name: 'Fresh Cabbage',
                    price: 160,
                    image: 'ü•¨',
                    farmer: 'Sandamali Fernando',
                    location: 'Kurunegala',
                    category: 'vegetables',
                    description: 'Fresh and crispy cabbage, perfect for salads and cooking.',
                    available: true
                },
                {
                    id: '9',
                    name: 'Fresh Curry Leaves',
                    price: 250,
                    image: 'üåø',
                    farmer: 'Dharmasena Silva',
                    location: 'Kandy',
                    category: 'herbs',
                    description: 'Aromatic fresh curry leaves, essential for authentic Sri Lankan cooking.',
                    organic: true,
                    available: true
                }
            ];

            let productsHTML = '';
            products.forEach(product => {
                const badges = [];
                if (product.organic) badges.push('<span class="badge badge-success">Organic</span>');
                if (product.available) badges.push('<span class="badge badge-info">Available</span>');
                if (product.limited) badges.push('<span class="badge badge-warning">Limited</span>');

                productsHTML += `
                    <div class="card" data-category="${product.category}" data-location="${product.location}" data-price="${product.price}">
                        <div style="text-align: center; padding: var(--spacing-lg);">
                            <div style="font-size: 3rem; margin-bottom: var(--spacing-md);">${product.image}</div>
                            <h4>${product.name}</h4>
                            <p class="text-muted">${product.farmer} (${product.location})</p>
                            <div style="font-size: 1.25rem; font-weight: bold; color: var(--primary-green); margin: var(--spacing-md) 0;">Rs. ${product.price}/kg</div>
                            <p style="font-size: 0.9rem; color: var(--dark-gray); margin: var(--spacing-xs) 0;">
                                ${product.description}
                            </p>
                            <div style="display: flex; gap: var(--spacing-xs); margin: var(--spacing-sm) 0; justify-content: center;">
                                ${badges.join('')}
                            </div>
                            <div style="display: flex; gap: var(--spacing-sm); margin-bottom: var(--spacing-sm); justify-content: center;">
                                <button class="btn btn-sm" onclick="updateProductQuantity('${product.id}', -1)">-</button>
                                <span style="padding: 0 var(--spacing-sm);" id="${product.id}-qty">1</span>
                                <button class="btn btn-sm" onclick="updateProductQuantity('${product.id}', 1)">+</button>
                            </div>
                            <button class="btn btn-primary w-full" onclick="addToCart('${product.id}', parseInt(document.getElementById('${product.id}-qty').textContent))">Add to Cart</button>
                            <button class="btn btn-outline w-full mt-sm" onclick="addToWishlist('${product.id}')">Add to Wishlist</button>
                        </div>
                    </div>
                `;
            });

            productsGrid.innerHTML = productsHTML;
        }

        // Load tracking data
        function loadTracking() {
            const trackingContainer = document.querySelector('#tracking-section .card');
            if (!trackingContainer) return;

            trackingContainer.innerHTML = `
                <div style="padding: var(--spacing-lg);">
                    <h3 style="margin-bottom: var(--spacing-lg);">Order Tracking</h3>
                    
                    <div class="order-card" data-status="shipped">
                        <div class="order-header">
                            <h4 class="order-title">Order #1003 - Sweet Mangoes</h4>
                            <div class="order-status shipped">In Transit</div>
                        </div>
                        <div style="margin: var(--spacing-lg) 0;">
                            <div style="display: flex; align-items: center; margin-bottom: var(--spacing-md);">
                                <div style="width: 20px; height: 20px; background: var(--primary-green); border-radius: 50%; margin-right: var(--spacing-sm);"></div>
                                <div>
                                    <div style="font-weight: bold;">Order Confirmed</div>
                                    <div style="font-size: 0.9rem; color: var(--dark-gray);">Aug 19, 2025 - 10:30 AM</div>
                                </div>
                            </div>
                            <div style="display: flex; align-items: center; margin-bottom: var(--spacing-md);">
                                <div style="width: 20px; height: 20px; background: var(--primary-green); border-radius: 50%; margin-right: var(--spacing-sm);"></div>
                                <div>
                                    <div style="font-weight: bold;">Processing</div>
                                    <div style="font-size: 0.9rem; color: var(--dark-gray);">Aug 19, 2025 - 2:15 PM</div>
                                </div>
                            </div>
                            <div style="display: flex; align-items: center; margin-bottom: var(--spacing-md);">
                                <div style="width: 20px; height: 20px; background: var(--primary-green); border-radius: 50%; margin-right: var(--spacing-sm);"></div>
                                <div>
                                    <div style="font-weight: bold;">Shipped</div>
                                    <div style="font-size: 0.9rem; color: var(--dark-gray);">Aug 20, 2025 - 9:00 AM</div>
                                </div>
                            </div>
                            <div style="display: flex; align-items: center; margin-bottom: var(--spacing-md);">
                                <div style="width: 20px; height: 20px; background: var(--light-gray); border-radius: 50%; margin-right: var(--spacing-sm);"></div>
                                <div>
                                    <div style="font-weight: bold;">Out for Delivery</div>
                                    <div style="font-size: 0.9rem; color: var(--dark-gray);">Expected: Aug 21, 2025</div>
                                </div>
                            </div>
                            <div style="display: flex; align-items: center;">
                                <div style="width: 20px; height: 20px; background: var(--light-gray); border-radius: 50%; margin-right: var(--spacing-sm);"></div>
                                <div>
                                    <div style="font-weight: bold;">Delivered</div>
                                    <div style="font-size: 0.9rem; color: var(--dark-gray);">Pending</div>
                                </div>
                            </div>
                        </div>
                        <div class="order-actions">
                            <button class="btn btn-secondary" onclick="viewOrderDetails('1003')">View Order Details</button>
                            <button class="btn btn-primary" onclick="contactTransporter('1003')">Contact Transporter</button>
                        </div>
                    </div>
                </div>
            `;
        }

        // Load reviews data
        function loadReviews() {
            const reviewsContainer = document.querySelector('#reviews-section .card');
            if (!reviewsContainer) return;

            reviewsContainer.innerHTML = `
                <div style="padding: var(--spacing-lg);">
                    <h3 style="margin-bottom: var(--spacing-lg);">My Reviews</h3>
                    
                    <div style="margin-bottom: var(--spacing-lg);">
                        <div style="display: flex; align-items: center; margin-bottom: var(--spacing-md);">
                            <div style="font-size: 2rem; margin-right: var(--spacing-sm);">üçÖ</div>
                            <div>
                                <div style="font-weight: bold;">Fresh Tomatoes - Ranjith Fernando</div>
                                <div style="color: var(--dark-gray);">Order #1001</div>
                                <div style="margin-top: var(--spacing-xs);">
                                    <span style="color: #fbbf24;">‚òÖ‚òÖ‚òÖ‚òÖ‚òÖ</span>
                                    <span style="margin-left: var(--spacing-sm);">Excellent quality and fast delivery!</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div style="margin-bottom: var(--spacing-lg);">
                        <div style="display: flex; align-items: center; margin-bottom: var(--spacing-md);">
                            <div style="font-size: 2rem; margin-right: var(--spacing-sm);">ü•¨</div>
                            <div>
                                <div style="font-weight: bold;">Green Beans - Kumari Silva</div>
                                <div style="color: var(--dark-gray);">Order #1002</div>
                                <div style="margin-top: var(--spacing-xs);">
                                    <span style="color: #fbbf24;">‚òÖ‚òÖ‚òÖ‚òÖ‚òÜ</span>
                                    <span style="margin-left: var(--spacing-sm);">Good quality, slightly delayed delivery</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <button class="btn btn-primary" onclick="writeNewReview()">Write New Review</button>
                </div>
            `;
        }

        // Load notifications data
        function loadNotifications() {
            const notificationsContainer = document.querySelector('#notifications-section .card');
            if (!notificationsContainer) return;

            notificationsContainer.innerHTML = `
                <div style="padding: var(--spacing-lg);">
                    <h3 style="margin-bottom: var(--spacing-lg);">Notifications</h3>
                    
                    <div style="margin-bottom: var(--spacing-md); padding: var(--spacing-md); background: var(--light-green); border-radius: var(--radius-md);">
                        <div style="font-weight: bold; margin-bottom: var(--spacing-xs);">Order Shipped</div>
                        <div style="font-size: 0.9rem; color: var(--dark-gray);">Your order #1003 has been shipped and is on its way!</div>
                        <div style="font-size: 0.8rem; color: var(--dark-gray); margin-top: var(--spacing-xs);">2 hours ago</div>
                    </div>

                    <div style="margin-bottom: var(--spacing-md); padding: var(--spacing-md); background: var(--light-green); border-radius: var(--radius-md);">
                        <div style="font-weight: bold; margin-bottom: var(--spacing-xs);">New Product Available</div>
                        <div style="font-size: 0.9rem; color: var(--dark-gray);">Fresh organic carrots are now available from Lakshmi Perera</div>
                        <div style="font-size: 0.8rem; color: var(--dark-gray); margin-top: var(--spacing-xs);">1 day ago</div>
                    </div>

                    <div style="margin-bottom: var(--spacing-md); padding: var(--spacing-md); background: var(--light-green); border-radius: var(--radius-md);">
                        <div style="font-weight: bold; margin-bottom: var(--spacing-xs);">Price Drop Alert</div>
                        <div style="font-size: 0.9rem; color: var(--dark-gray);">Sweet mangoes price has dropped to Rs. 140/kg</div>
                        <div style="font-size: 0.8rem; color: var(--dark-gray); margin-top: var(--spacing-xs);">2 days ago</div>
                    </div>

                    <button class="btn btn-secondary" onclick="markAllAsRead()">Mark All as Read</button>
                </div>
            `;
        }

        // Additional functions
        function updateProductQuantity(productId, change) {
            const qtyElement = document.getElementById(productId + '-qty');
            if (qtyElement) {
                let currentQty = parseInt(qtyElement.textContent);
                currentQty = Math.max(1, currentQty + change);
                qtyElement.textContent = currentQty;
            }
        }

        function contactTransporter(orderId) {
            showNotification(`Contacting transporter for order #${orderId}`, 'info');
        }

        function writeNewReview() {
            showNotification('Opening review form...', 'info');
        }

        function markAllAsRead() {
            showNotification('All notifications marked as read', 'success');
            loadNotifications();
        }

        // Load tracking data
        function loadTracking() {
            const trackingContainer = document.querySelector('#tracking-section .card');
            if (!trackingContainer) return;

            trackingContainer.innerHTML = `
                <div style="padding: var(--spacing-lg);">
                    <h3 style="margin-bottom: var(--spacing-lg);">Order Tracking</h3>
                    
                    <div class="order-card" data-status="shipped">
                        <div class="order-header">
                            <h4 class="order-title">Order #1003 - Sweet Mangoes</h4>
                            <div class="order-status shipped">In Transit</div>
                        </div>
                        <div style="margin: var(--spacing-lg) 0;">
                            <div style="display: flex; align-items: center; margin-bottom: var(--spacing-md);">
                                <div style="width: 20px; height: 20px; background: var(--primary-green); border-radius: 50%; margin-right: var(--spacing-sm);"></div>
                                <div>
                                    <div style="font-weight: bold;">Order Confirmed</div>
                                    <div style="font-size: 0.9rem; color: var(--dark-gray);">Aug 19, 2025 - 10:30 AM</div>
                                </div>
                            </div>
                            <div style="display: flex; align-items: center; margin-bottom: var(--spacing-md);">
                                <div style="width: 20px; height: 20px; background: var(--primary-green); border-radius: 50%; margin-right: var(--spacing-sm);"></div>
                                <div>
                                    <div style="font-weight: bold;">Processing</div>
                                    <div style="font-size: 0.9rem; color: var(--dark-gray);">Aug 19, 2025 - 2:15 PM</div>
                                </div>
                            </div>
                            <div style="display: flex; align-items: center; margin-bottom: var(--spacing-md);">
                                <div style="width: 20px; height: 20px; background: var(--primary-green); border-radius: 50%; margin-right: var(--spacing-sm);"></div>
                                <div>
                                    <div style="font-weight: bold;">Shipped</div>
                                    <div style="font-size: 0.9rem; color: var(--dark-gray);">Aug 20, 2025 - 9:00 AM</div>
                                </div>
                            </div>
                            <div style="display: flex; align-items: center; margin-bottom: var(--spacing-md);">
                                <div style="width: 20px; height: 20px; background: var(--light-gray); border-radius: 50%; margin-right: var(--spacing-sm);"></div>
                                <div>
                                    <div style="font-weight: bold;">Out for Delivery</div>
                                    <div style="font-size: 0.9rem; color: var(--dark-gray);">Expected: Aug 21, 2025</div>
                                </div>
                            </div>
                            <div style="display: flex; align-items: center;">
                                <div style="width: 20px; height: 20px; background: var(--light-gray); border-radius: 50%; margin-right: var(--spacing-sm);"></div>
                                <div>
                                    <div style="font-weight: bold;">Delivered</div>
                                    <div style="font-size: 0.9rem; color: var(--dark-gray);">Pending</div>
                                </div>
                            </div>
                        </div>
                        <div class="order-actions">
                            <button class="btn btn-secondary" onclick="viewOrderDetails('1003')">View Order Details</button>
                            <button class="btn btn-primary" onclick="contactTransporter('1003')">Contact Transporter</button>
                        </div>
                    </div>
                </div>
            `;
        }

        // Load reviews data
        function loadReviews() {
            const reviewsContainer = document.querySelector('#reviews-section .card');
            if (!reviewsContainer) return;

            reviewsContainer.innerHTML = `
                <div style="padding: var(--spacing-lg);">
                    <h3 style="margin-bottom: var(--spacing-lg);">My Reviews</h3>
                    
                    <div style="margin-bottom: var(--spacing-lg);">
                        <div style="display: flex; align-items: center; margin-bottom: var(--spacing-md);">
                            <div style="font-size: 2rem; margin-right: var(--spacing-sm);">üçÖ</div>
                            <div>
                                <div style="font-weight: bold;">Fresh Tomatoes - Ranjith Fernando</div>
                                <div style="color: var(--dark-gray);">Order #1001</div>
                                <div style="margin-top: var(--spacing-xs);">
                                    <span style="color: #fbbf24;">‚òÖ‚òÖ‚òÖ‚òÖ‚òÖ</span>
                                    <span style="margin-left: var(--spacing-sm);">Excellent quality and fast delivery!</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div style="margin-bottom: var(--spacing-lg);">
                        <div style="display: flex; align-items: center; margin-bottom: var(--spacing-md);">
                            <div style="font-size: 2rem; margin-right: var(--spacing-sm);">ü•¨</div>
                            <div>
                                <div style="font-weight: bold;">Green Beans - Kumari Silva</div>
                                <div style="color: var(--dark-gray);">Order #1002</div>
                                <div style="margin-top: var(--spacing-xs);">
                                    <span style="color: #fbbf24;">‚òÖ‚òÖ‚òÖ‚òÖ‚òÜ</span>
                                    <span style="margin-left: var(--spacing-sm);">Good quality, slightly delayed delivery</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <button class="btn btn-primary" onclick="writeNewReview()">Write New Review</button>
                </div>
            `;
        }

        // Load notifications data
        function loadNotifications() {
            const notificationsContainer = document.querySelector('#notifications-section .card');
            if (!notificationsContainer) return;

            notificationsContainer.innerHTML = `
                <div style="padding: var(--spacing-lg);">
                    <h3 style="margin-bottom: var(--spacing-lg);">Notifications</h3>
                    
                    <div style="margin-bottom: var(--spacing-md); padding: var(--spacing-md); background: var(--light-green); border-radius: var(--radius-md);">
                        <div style="font-weight: bold; margin-bottom: var(--spacing-xs);">Order Shipped</div>
                        <div style="font-size: 0.9rem; color: var(--dark-gray);">Your order #1003 has been shipped and is on its way!</div>
                        <div style="font-size: 0.8rem; color: var(--dark-gray); margin-top: var(--spacing-xs);">2 hours ago</div>
                    </div>

                    <div style="margin-bottom: var(--spacing-md); padding: var(--spacing-md); background: var(--light-green); border-radius: var(--radius-md);">
                        <div style="font-weight: bold; margin-bottom: var(--spacing-xs);">New Product Available</div>
                        <div style="font-size: 0.9rem; color: var(--dark-gray);">Fresh organic carrots are now available from Lakshmi Perera</div>
                        <div style="font-size: 0.8rem; color: var(--dark-gray); margin-top: var(--spacing-xs);">1 day ago</div>
                    </div>

                    <div style="margin-bottom: var(--spacing-md); padding: var(--spacing-md); background: var(--light-green); border-radius: var(--radius-md);">
                        <div style="font-weight: bold; margin-bottom: var(--spacing-xs);">Price Drop Alert</div>
                        <div style="font-size: 0.9rem; color: var(--dark-gray);">Sweet mangoes price has dropped to Rs. 140/kg</div>
                        <div style="font-size: 0.8rem; color: var(--dark-gray); margin-top: var(--spacing-xs);">2 days ago</div>
                    </div>

                    <button class="btn btn-secondary" onclick="markAllAsRead()">Mark All as Read</button>
                </div>
            `;
        }

        // Cart functions
        function addToCart(productId, quantity) {
            const cart = JSON.parse(localStorage.getItem('buyerCart')) || [];
            
            // Product data mapping
            const productData = {
                '1': { name: 'Fresh Tomatoes', price: 120, farmer: 'Ranjith Fernando (Matale)', icon: 'üçÖ' },
                '2': { name: 'Green Beans', price: 180, farmer: 'Kumari Silva (Kandy)', icon: 'ü´õ' },
                '3': { name: 'Red Rice', price: 95, farmer: 'Sunil Perera (Anuradhapura)', icon: 'üåæ' },
                '4': { name: 'Sweet Mangoes', price: 150, farmer: 'Pradeep Jayasinghe (Galle)', icon: 'ü•≠' },
                '5': { name: 'Fresh Carrots', price: 200, farmer: 'Manjula Rathnayake (Nuwara Eliya)', icon: 'ü•ï' },
                '6': { name: 'Red Chili Powder', price: 800, farmer: 'Gamini Wickramasinghe (Matale)', icon: 'üå∂Ô∏è' },
                '7': { name: 'Ripe Bananas', price: 80, farmer: 'Asanka Perera (Ratnapura)', icon: 'üçå' },
                '8': { name: 'Fresh Cabbage', price: 160, farmer: 'Sandamali Fernando (Kurunegala)', icon: 'ü•¨' },
                '9': { name: 'Fresh Curry Leaves', price: 250, farmer: 'Dharmasena Silva (Kandy)', icon: 'üåø' }
            };

            const existingItem = cart.find(item => item.id === productId);
            if (existingItem) {
                existingItem.quantity += quantity;
            } else {
                cart.push({
                    id: productId,
                    name: productData[productId].name,
                    price: productData[productId].price,
                    farmer: productData[productId].farmer,
                    icon: productData[productId].icon,
                    quantity: quantity
                });
            }

            localStorage.setItem('buyerCart', JSON.stringify(cart));
            showNotification(`${productData[productId].name} added to cart!`, 'success');
        }

        function removeFromCart(productId) {
            const cart = JSON.parse(localStorage.getItem('buyerCart')) || [];
            const updatedCart = cart.filter(item => item.id !== productId);
            localStorage.setItem('buyerCart', JSON.stringify(updatedCart));
            loadCart();
            showNotification('Item removed from cart', 'success');
        }

        function updateQuantity(productId, newQuantity) {
            if (newQuantity <= 0) {
                removeFromCart(productId);
                return;
            }

            const cart = JSON.parse(localStorage.getItem('buyerCart')) || [];
            const item = cart.find(item => item.id === productId);
            if (item) {
                item.quantity = newQuantity;
                localStorage.setItem('buyerCart', JSON.stringify(cart));
                loadCart();
            }
        }

        function updateProductQuantity(productId, change) {
            const qtyElement = document.getElementById(productId + '-qty');
            if (qtyElement) {
                let currentQty = parseInt(qtyElement.textContent);
                currentQty = Math.max(1, currentQty + change);
                qtyElement.textContent = currentQty;
            }
        }

        // Wishlist functions
        function addToWishlist(productId) {
            const wishlist = JSON.parse(localStorage.getItem('buyerWishlist')) || [];
            if (!wishlist.includes(productId)) {
                wishlist.push(productId);
                localStorage.setItem('buyerWishlist', JSON.stringify(wishlist));
                showNotification('Added to wishlist!', 'success');
            } else {
                showNotification('Already in wishlist!', 'info');
            }
        }

        function removeFromWishlist(productId) {
            const wishlist = JSON.parse(localStorage.getItem('buyerWishlist')) || [];
            const updatedWishlist = wishlist.filter(id => id !== productId);
            localStorage.setItem('buyerWishlist', JSON.stringify(updatedWishlist));
            loadWishlist();
            showNotification('Removed from wishlist', 'success');
        }

        // Order functions
        function viewOrderDetails(orderId) {
            showNotification(`Viewing order details for #${orderId}`, 'info');
        }

        function cancelOrder(orderId) {
            if (confirm('Are you sure you want to cancel this order?')) {
                showNotification(`Order #${orderId} cancelled successfully`, 'success');
                loadOrders();
            }
        }

        function reorder(orderId) {
            showNotification(`Reordering items from order #${orderId}`, 'info');
            // Add items to cart logic here
        }

        function rateOrder(orderId) {
            showNotification(`Rating order #${orderId}`, 'info');
            // Open rating modal logic here
        }

        function trackOrder(orderId) {
            showSection('tracking');
        }

        function contactTransporter(orderId) {
            showNotification(`Contacting transporter for order #${orderId}`, 'info');
        }

        // Checkout function
        function proceedToCheckout() {
            const cart = JSON.parse(localStorage.getItem('buyerCart')) || [];
            if (cart.length === 0) {
                showNotification('Your cart is empty!', 'warning');
                return;
            }
            window.location.href = 'checkout.html';
        }

        // Review functions
        function writeNewReview() {
            showNotification('Opening review form...', 'info');
        }

        // Notification functions
        function markAllAsRead() {
            showNotification('All notifications marked as read', 'success');
            loadNotifications();
        }

        // Profile functions
        function updateProfile() {
            const name = document.getElementById('profileName').value;
            const phone = document.getElementById('profilePhone').value;
            const location = document.getElementById('profileLocation').value;
            const business = document.getElementById('profileBusiness').value;
            const businessType = document.getElementById('profileType').value;
            const address = document.getElementById('profileAddress').value;

            if (!name || !phone || !location || !business || !address) {
                showNotification('Please fill in all required fields', 'error');
                return;
            }

            // Save to localStorage (in real app, this would be an API call)
            const profileData = {
                name: name,
                phone: phone,
                location: location,
                business: business,
                businessType: businessType,
                address: address
            };
            localStorage.setItem('buyerProfile', JSON.stringify(profileData));
            
            // Update the header name
            document.getElementById('buyerName').textContent = name;
            
            showNotification('Profile updated successfully!', 'success');
        }

        function resetProfile() {
            // Reset to original values
            document.getElementById('profileName').value = 'Duleeka Rathnayake';
            document.getElementById('profilePhone').value = '+94 71 234 5678';
            document.getElementById('profileLocation').value = 'Colombo';
            document.getElementById('profileBusiness').value = 'Green Leaf Restaurant';
            document.getElementById('profileType').value = 'restaurant';
            document.getElementById('profileAddress').value = '123 Main Street, Colombo 03, Western Province, Sri Lanka';
            
            showNotification('Profile reset to original values', 'info');
        }

        function changePassword() {
            const currentPassword = document.getElementById('currentPassword').value;
            const newPassword = document.getElementById('newPassword').value;
            const confirmPassword = document.getElementById('confirmPassword').value;

            if (!currentPassword || !newPassword || !confirmPassword) {
                showNotification('Please fill in all password fields', 'error');
                return;
            }

            if (newPassword !== confirmPassword) {
                showNotification('New passwords do not match', 'error');
                return;
            }

            if (newPassword.length < 6) {
                showNotification('Password must be at least 6 characters long', 'error');
                return;
            }

            // In real app, this would validate current password and update via API
            showNotification('Password changed successfully!', 'success');
            
            // Clear password fields
            document.getElementById('currentPassword').value = '';
            document.getElementById('newPassword').value = '';
            document.getElementById('confirmPassword').value = '';
        }

        function savePreferences() {
            const preferences = {
                emailNotifications: document.getElementById('emailNotifications').checked,
                smsNotifications: document.getElementById('smsNotifications').checked,
                orderUpdates: document.getElementById('orderUpdates').checked,
                priceAlerts: document.getElementById('priceAlerts').checked,
                newProducts: document.getElementById('newProducts').checked,
                preferredTime: document.getElementById('preferredTime').value,
                deliveryRadius: document.getElementById('deliveryRadius').value,
                contactlessDelivery: document.getElementById('contactlessDelivery').checked,
                specialInstructions: document.getElementById('specialInstructions').value
            };

            localStorage.setItem('buyerPreferences', JSON.stringify(preferences));
            showNotification('Preferences saved successfully!', 'success');
        }

        function downloadData() {
            const profileData = JSON.parse(localStorage.getItem('buyerProfile')) || {};
            const orderData = JSON.parse(localStorage.getItem('buyerOrders')) || [];
            const cartData = JSON.parse(localStorage.getItem('buyerCart')) || [];
            const wishlistData = JSON.parse(localStorage.getItem('buyerWishlist')) || [];

            const dataToDownload = {
                profile: profileData,
                orders: orderData,
                cart: cartData,
                wishlist: wishlistData,
                exportDate: new Date().toISOString()
            };

            const dataStr = JSON.stringify(dataToDownload, null, 2);
            const dataBlob = new Blob([dataStr], {type: 'application/json'});
            const url = URL.createObjectURL(dataBlob);
            
            const link = document.createElement('a');
            link.href = url;
            link.download = 'agrolink-buyer-data.json';
            link.click();
            
            URL.revokeObjectURL(url);
            showNotification('Data downloaded successfully!', 'success');
        }

        function exportOrders() {
            const orders = [
                { id: '1001', product: 'Fresh Tomatoes', quantity: '2kg', total: 'Rs. 240', date: 'Aug 15, 2025', status: 'Delivered' },
                { id: '1002', product: 'Green Beans', quantity: '1kg', total: 'Rs. 180', date: 'Aug 18, 2025', status: 'Pending' },
                { id: '1003', product: 'Sweet Mangoes', quantity: '3kg', total: 'Rs. 450', date: 'Aug 19, 2025', status: 'Shipped' }
            ];

            let csvContent = 'Order ID,Product,Quantity,Total,Date,Status\n';
            orders.forEach(order => {
                csvContent += `${order.id},${order.product},${order.quantity},${order.total},${order.date},${order.status}\n`;
            });

            const blob = new Blob([csvContent], { type: 'text/csv' });
            const url = URL.createObjectURL(blob);
            
            const link = document.createElement('a');
            link.href = url;
            link.download = 'agrolink-orders.csv';
            link.click();
            
            URL.revokeObjectURL(url);
            showNotification('Order history exported successfully!', 'success');
        }

        function viewPrivacyPolicy() {
            showNotification('Opening privacy policy...', 'info');
            // In real app, this would open a modal or redirect to privacy policy page
        }

        function deactivateAccount() {
            if (confirm('Are you sure you want to deactivate your account? You can reactivate it later by contacting support.')) {
                showNotification('Account deactivated. Contact support to reactivate.', 'warning');
                // In real app, this would make an API call to deactivate the account
            }
        }

        function deleteAccount() {
            if (confirm('Are you sure you want to permanently delete your account? This action cannot be undone.')) {
                if (confirm('This will permanently delete all your data including orders, reviews, and preferences. Are you absolutely sure?')) {
                    showNotification('Account deletion request submitted. You will receive a confirmation email.', 'warning');
                    // In real app, this would make an API call to delete the account
                }
            }
        }

        function contactSupport() {
            showNotification('Opening support chat...', 'info');
            // In real app, this would open a support chat or redirect to support page
        }

        // Load profile data on page load
        function loadProfileData() {
            const profileData = JSON.parse(localStorage.getItem('buyerProfile'));
            const preferences = JSON.parse(localStorage.getItem('buyerPreferences'));

            if (profileData) {
                document.getElementById('profileName').value = profileData.name || 'Duleeka Rathnayake';
                document.getElementById('profilePhone').value = profileData.phone || '+94 71 234 5678';
                document.getElementById('profileLocation').value = profileData.location || 'Colombo';
                document.getElementById('profileBusiness').value = profileData.business || 'Green Leaf Restaurant';
                document.getElementById('profileType').value = profileData.businessType || 'restaurant';
                document.getElementById('profileAddress').value = profileData.address || '123 Main Street, Colombo 03, Western Province, Sri Lanka';
            }

            if (preferences) {
                document.getElementById('emailNotifications').checked = preferences.emailNotifications !== false;
                document.getElementById('smsNotifications').checked = preferences.smsNotifications || false;
                document.getElementById('orderUpdates').checked = preferences.orderUpdates !== false;
                document.getElementById('priceAlerts').checked = preferences.priceAlerts !== false;
                document.getElementById('newProducts').checked = preferences.newProducts || false;
                document.getElementById('preferredTime').value = preferences.preferredTime || 'afternoon';
                document.getElementById('deliveryRadius').value = preferences.deliveryRadius || '25';
                document.getElementById('contactlessDelivery').checked = preferences.contactlessDelivery !== false;
                document.getElementById('specialInstructions').value = preferences.specialInstructions || 'Please call 10 minutes before arrival';
            }
        }

        // Filter functionality for orders
        function filterOrders() {
            const searchTerm = document.getElementById('orderSearch')?.value.toLowerCase() || '';
            const statusValue = document.getElementById('statusFilter')?.value || '';
            const dateValue = document.getElementById('dateFilter')?.value || '';
            const farmerValue = document.getElementById('farmerFilter')?.value.toLowerCase() || '';

            const orderCards = document.querySelectorAll('.order-card');
            orderCards.forEach(card => {
                const orderText = card.textContent.toLowerCase();
                const orderStatus = card.dataset.status || '';
                
                const matchesSearch = searchTerm === '' || orderText.includes(searchTerm);
                const matchesStatus = statusValue === '' || orderStatus === statusValue;
                const matchesFarmer = farmerValue === '' || orderText.includes(farmerValue);
                
                if (matchesSearch && matchesStatus && matchesFarmer) {
                    card.style.display = 'block';
                } else {
                    card.style.display = 'none';
                }
            });
        }

        // Filter functionality for products
        function filterProducts() {
            const searchTerm = document.getElementById('productSearch')?.value.toLowerCase() || '';
            const categoryValue = document.getElementById('categoryFilter')?.value || '';
            const locationValue = document.getElementById('locationFilter')?.value || '';
            const priceValue = document.getElementById('priceFilter')?.value || '';

            const productCards = document.querySelectorAll('#productsGrid .card');
            productCards.forEach(card => {
                const productText = card.textContent.toLowerCase();
                const productCategory = card.dataset.category || '';
                const productLocation = card.dataset.location || '';
                const productPrice = parseInt(card.dataset.price) || 0;
                
                const matchesSearch = searchTerm === '' || productText.includes(searchTerm);
                const matchesCategory = categoryValue === '' || productCategory === categoryValue;
                const matchesLocation = locationValue === '' || productLocation === locationValue;
                
                let matchesPrice = true;
                if (priceValue) {
                    const [min, max] = priceValue.split('-').map(p => p === '+' ? Infinity : parseInt(p));
                    matchesPrice = productPrice >= min && (max === Infinity ? true : productPrice <= max);
                }
                
                if (matchesSearch && matchesCategory && matchesLocation && matchesPrice) {
                    card.style.display = 'block';
                } else {
                    card.style.display = 'none';
                }
            });
        }

        // Update order statuses
        function updateOrderStatuses() {
            // This function can be used to update order statuses dynamically
            // For now, it's just a placeholder
        }

        // Initialize dashboard
        document.addEventListener('DOMContentLoaded', function() {
            // Load user data from localStorage (set by PHP login)
            const buyerName = localStorage.getItem('user_name') || 'Buyer';
            const buyerId = localStorage.getItem('user_id');
            const buyerEmail = localStorage.getItem('user_email');
            
            // Check if user is logged in
            if (!buyerId || !buyerEmail) {
                window.location.href = 'login.html';
                return;
            }
            
            document.getElementById('buyerName').textContent = buyerName;
            
            // Load dashboard data
            loadDashboardData();
            
            // Load profile data
            loadProfileData();
            
            // Setup navigation
            setupNavigation();
            
            // Show overview section by default
            showSection('overview');
            
            // Setup event listeners for filters
            const searchInput = document.getElementById('orderSearch');
            const statusFilter = document.getElementById('statusFilter');
            const dateFilter = document.getElementById('dateFilter');
            const farmerFilter = document.getElementById('farmerFilter');

            if (searchInput) searchInput.addEventListener('input', filterOrders);
            if (statusFilter) statusFilter.addEventListener('change', filterOrders);
            if (dateFilter) dateFilter.addEventListener('change', filterOrders);
            if (farmerFilter) farmerFilter.addEventListener('input', filterOrders);

            // Setup event listeners for product filters
            const productSearch = document.getElementById('productSearch');
            const categoryFilter = document.getElementById('categoryFilter');
            const locationFilter = document.getElementById('locationFilter');
            const priceFilter = document.getElementById('priceFilter');

            if (productSearch) productSearch.addEventListener('input', filterProducts);
            if (categoryFilter) categoryFilter.addEventListener('change', filterProducts);
            if (locationFilter) locationFilter.addEventListener('change', filterProducts);
            if (priceFilter) priceFilter.addEventListener('change', filterProducts);
        });

        // Navigation setup
        function setupNavigation() {
            const menuLinks = document.querySelectorAll('.menu-link');
            menuLinks.forEach(link => {
                link.addEventListener('click', function(e) {
                    e.preventDefault();
                    const section = this.getAttribute('data-section');
                    showSection(section);
                    
                    menuLinks.forEach(l => l.classList.remove('active'));
                    this.classList.add('active');
                });
            });
        }
    </script>
</body>
</html>