<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Farmer Dashboard - AgroLink</title>
    <link rel="stylesheet" href="assets/css/style.css">
</head>
<body>
    <!-- Header -->
    <header class="header">
        <nav class="nav container">
            <div class="logo">
                <img src="assets/img/Logo.png" alt="AgroLink" style="height: 40px;">
            </div>
            <div class="nav-actions">
                <div class="user-info">
                    <span>Welcome, <span id="farmerName">Farmer</span></span>
                    <button onclick="logout()" class="btn btn-sm">Logout</button>
                </div>
            </div>
        </nav>
    </header>

    <!-- Dashboard Layout -->
    <div class="dashboard">
        <!-- Sidebar -->
        <aside class="sidebar">
            <h3 style="margin-bottom: var(--spacing-lg); color: var(--primary-green);">üßë‚Äçüåæ Farmer Dashboard</h3>
            <ul class="sidebar-menu">
                <li><a href="#dashboard" class="menu-link active" data-section="dashboard">üìä Dashboard</a></li>
                <li><a href="#products" class="menu-link" data-section="products">üåæ My Products</a></li>
                <li><a href="#orders" class="menu-link" data-section="orders">üì¶ Orders</a></li>
                <li><a href="#earnings" class="menu-link" data-section="earnings">üí∞ Earnings</a></li>
                <li><a href="#deliveries" class="menu-link" data-section="deliveries">üöö Deliveries</a></li>
                <li><a href="#profile" class="menu-link" data-section="profile">üë§ Profile</a></li>
                <li><a href="#analytics" class="menu-link" data-section="analytics">üìà Analytics</a></li>
            </ul>
        </aside>

        <!-- Main Content -->
        <main class="main-content">
            <!-- Dashboard Overview -->
            <div id="dashboard-section" class="content-section">
                <h1 style="margin-bottom: var(--spacing-lg);">Dashboard Overview</h1>
                
                <!-- Statistics Cards -->
                <div class="dashboard-stats">
                    <div class="stat-card">
                        <div class="stat-number" id="totalProducts">0</div>
                        <div class="stat-label">Active Products</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="pendingOrders">0</div>
                        <div class="stat-label">Pending Orders</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="monthlyEarnings">Rs. 0</div>
                        <div class="stat-label">This Month</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="totalEarnings">Rs. 0</div>
                        <div class="stat-label">Total Earnings</div>
                    </div>
                </div>

                <!-- Recent Activity -->
                <div class="grid grid-2" style="margin-top: var(--spacing-xl);">
                    <div class="card">
                        <div style="padding: var(--spacing-lg); border-bottom: 1px solid var(--medium-gray);">
                            <h3>üìã Recent Orders</h3>
                        </div>
                        <div id="recentOrders" style="padding: var(--spacing-lg);">
                            <!-- Recent orders will be populated by JavaScript -->
                        </div>
                    </div>
                    
                    <div class="card">
                        <div style="padding: var(--spacing-lg); border-bottom: 1px solid var(--medium-gray);">
                            <h3>üåæ Top Products</h3>
                        </div>
                        <div id="topProducts" style="padding: var(--spacing-lg);">
                            <!-- Top products will be populated by JavaScript -->
                        </div>
                    </div>
                </div>

                <!-- Quick Actions -->
                <div class="card" style="margin-top: var(--spacing-xl);">
                    <div style="padding: var(--spacing-lg); border-bottom: 1px solid var(--medium-gray);">
                        <h3>‚ö° Quick Actions</h3>
                    </div>
                    <div style="padding: var(--spacing-lg);">
                        <div class="grid grid-4">
                            <button class="btn btn-primary" onclick="showSection('products')">‚ûï Add Product</button>
                            <button class="btn btn-secondary" onclick="showSection('orders')">üì¶ View Orders</button>
                            <button class="btn btn-secondary" onclick="showSection('earnings')">üí∞ Check Earnings</button>
                            <button class="btn btn-secondary" onclick="showSection('profile')">üë§ Update Profile</button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Products Management -->
            <div id="products-section" class="content-section" style="display: none;">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: var(--spacing-lg);">
                    <h1>üåæ My Products</h1>
                    <button class="btn btn-primary" data-modal="addProductModal">‚ûï Add New Product</button>
                </div>

                <!-- Product Filters -->
                <div class="filters">
                    <div class="filters-row">
                        <div class="filter-group">
                            <label for="productSearch">Search Products</label>
                            <input type="text" id="productSearch" class="form-control" placeholder="Search by name...">
                        </div>
                        <div class="filter-group">
                            <label for="statusFilter">Status</label>
                            <select id="statusFilter" class="form-control">
                                <option value="">All Status</option>
                                <option value="available">Available</option>
                                <option value="sold-out">Sold Out</option>
                                <option value="pending">Pending</option>
                            </select>
                        </div>
                        <div class="filter-group">
                            <label for="categoryProductFilter">Category</label>
                            <select id="categoryProductFilter" class="form-control">
                                <option value="">All Categories</option>
                                <option value="vegetables">Vegetables</option>
                                <option value="fruits">Fruits</option>
                                <option value="grains">Grains</option>
                                <option value="spices">Spices</option>
                                <option value="herbs">Herbs</option>
                                <option value="legumes">Legumes</option>
                            </select>
                        </div>
                    </div>
                </div>

                <!-- Products Table -->
                <div class="table-container">
                    <table class="table">
                        <thead>
                            <tr>
                                <th>Product</th>
                                <th>Category</th>
                                <th>Price/kg</th>
                                <th>Stock (kg)</th>
                                <th>Status</th>
                                <th>Harvest Date</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="productsTableBody">
                            <!-- Products will be populated by JavaScript -->
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Orders Management -->
            <div id="orders-section" class="content-section" style="display: none;">
                <h1 style="margin-bottom: var(--spacing-lg);">üì¶ Order Management</h1>

                <!-- Order Filters -->
                <div class="filters">
                    <div class="filters-row">
                        <div class="filter-group">
                            <label for="orderSearch">Search Orders</label>
                            <input type="text" id="orderSearch" class="form-control" placeholder="Search by order ID or buyer...">
                        </div>
                        <div class="filter-group">
                            <label for="orderStatusFilter">Status</label>
                            <select id="orderStatusFilter" class="form-control">
                                <option value="">All Status</option>
                                <option value="pending">Pending</option>
                                <option value="accepted">Accepted</option>
                                <option value="ready">Ready for Delivery</option>
                                <option value="in-transit">In Transit</option>
                                <option value="delivered">Delivered</option>
                                <option value="rejected">Rejected</option>
                            </select>
                        </div>
                        <div class="filter-group">
                            <label for="orderDateFilter">Date Range</label>
                            <select id="orderDateFilter" class="form-control">
                                <option value="">All Time</option>
                                <option value="today">Today</option>
                                <option value="week">This Week</option>
                                <option value="month">This Month</option>
                            </select>
                        </div>
                    </div>
                </div>

                <!-- Orders Table -->
                <div class="table-container">
                    <table class="table">
                        <thead>
                            <tr>
                                <th>Order ID</th>
                                <th>Buyer</th>
                                <th>Products</th>
                                <th>Total</th>
                                <th>Status</th>
                                <th>Date</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="ordersTableBody">
                            <!-- Orders will be populated by JavaScript -->
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Earnings -->
            <div id="earnings-section" class="content-section" style="display: none;">
                <h1 style="margin-bottom: var(--spacing-lg);">üí∞ Earnings Overview</h1>

                <!-- Earnings Stats -->
                <div class="dashboard-stats">
                    <div class="stat-card">
                        <div class="stat-number" id="todayEarnings">Rs. 0</div>
                        <div class="stat-label">Today</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="weekEarnings">Rs. 0</div>
                        <div class="stat-label">This Week</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="monthEarningsDetail">Rs. 0</div>
                        <div class="stat-label">This Month</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="yearEarnings">Rs. 0</div>
                        <div class="stat-label">This Year</div>
                    </div>
                </div>

                <!-- Earnings Chart Placeholder -->
                <div class="card" style="margin-top: var(--spacing-xl);">
                    <div style="padding: var(--spacing-lg); border-bottom: 1px solid var(--medium-gray);">
                        <h3>üìà Monthly Earnings Trend</h3>
                    </div>
                    <div style="padding: var(--spacing-xl); text-align: center; color: var(--dark-gray);">
                        <div style="font-size: 4rem; margin-bottom: var(--spacing-md);">üìä</div>
                        <p>Earnings chart will be implemented with a charting library</p>
                        <p style="font-size: 0.9rem; margin-top: var(--spacing-md);">Shows monthly earnings trends, top-selling products, and seasonal patterns</p>
                    </div>
                </div>

                <!-- Export & Download -->
                <div class="card" style="margin-top: var(--spacing-lg);">
                    <div style="padding: var(--spacing-lg);">
                        <h3>üì• Export Sales Data</h3>
                        <p style="margin: var(--spacing-md) 0; color: var(--dark-gray);">Download your sales data for accounting and tax purposes</p>
                        <div style="display: flex; gap: var(--spacing-md); flex-wrap: wrap;">
                            <button class="btn btn-secondary" onclick="exportSalesData('week')">üìä This Week (CSV)</button>
                            <button class="btn btn-secondary" onclick="exportSalesData('month')">üìä This Month (CSV)</button>
                            <button class="btn btn-secondary" onclick="exportSalesData('year')">üìä This Year (CSV)</button>
                            <button class="btn btn-primary" onclick="exportSalesData('all')">üìä All Time (CSV)</button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Deliveries -->
            <div id="deliveries-section" class="content-section" style="display: none;">
                <h1 style="margin-bottom: var(--spacing-lg);">üöö Delivery Coordination</h1>

                <!-- Delivery Stats -->
                <div class="dashboard-stats">
                    <div class="stat-card">
                        <div class="stat-number" id="pendingDeliveries">0</div>
                        <div class="stat-label">Pending Deliveries</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="inTransitDeliveries">0</div>
                        <div class="stat-label">In Transit</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="completedDeliveries">0</div>
                        <div class="stat-label">Completed</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="avgDeliveryTime">0</div>
                        <div class="stat-label">Avg. Delivery Days</div>
                    </div>
                </div>

                <!-- Deliveries Table -->
                <div class="table-container" style="margin-top: var(--spacing-xl);">
                    <table class="table">
                        <thead>
                            <tr>
                                <th>Order ID</th>
                                <th>Buyer</th>
                                <th>Destination</th>
                                <th>Transporter</th>
                                <th>Status</th>
                                <th>Expected Date</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="deliveriesTableBody">
                            <!-- Deliveries will be populated by JavaScript -->
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Profile Management -->
            <div id="profile-section" class="content-section" style="display: none;">
                <h1 style="margin-bottom: var(--spacing-lg);">üë§ Farmer Profile</h1>

                <div class="grid grid-2" style="gap: var(--spacing-xl);">
                    <!-- Personal Information -->
                    <div class="card">
                        <div style="padding: var(--spacing-lg); border-bottom: 1px solid var(--medium-gray);">
                            <h3>üìã Personal Information</h3>
                        </div>
                        <div style="padding: var(--spacing-lg);">
                            <form id="personalInfoForm">
                                <div class="form-group">
                                    <label for="profileName">Full Name</label>
                                    <input type="text" id="profileName" name="name" class="form-control" required>
                                </div>
                                <div class="form-group">
                                    <label for="profileEmail">Email</label>
                                    <input type="email" id="profileEmail" name="email" class="form-control" required>
                                </div>
                                <div class="form-group">
                                    <label for="profilePhone">Phone</label>
                                    <input type="tel" id="profilePhone" name="phone" class="form-control" required>
                                </div>
                                <button type="submit" class="btn btn-primary">Update Personal Info</button>
                            </form>
                        </div>
                    </div>

                    <!-- Farm Information -->
                    <div class="card">
                        <div style="padding: var(--spacing-lg); border-bottom: 1px solid var(--medium-gray);">
                            <h3>üè° Farm Information</h3>
                        </div>
                        <div style="padding: var(--spacing-lg);">
                            <form id="farmInfoForm">
                                <div class="form-group">
                                    <label for="farmName">Farm Name</label>
                                    <input type="text" id="farmName" name="farmName" class="form-control">
                                </div>
                                <div class="form-group">
                                    <label for="farmSize">Farm Size (acres)</label>
                                    <input type="number" id="farmSize" name="farmSize" class="form-control" step="0.1" min="0">
                                </div>
                                <div class="form-group">
                                    <label for="farmLocation">Farm Location</label>
                                    <textarea id="farmLocation" name="farmLocation" class="form-control" rows="3"></textarea>
                                </div>
                                <div class="form-group">
                                    <label for="primaryCropsProfile">Primary Crops</label>
                                    <input type="text" id="primaryCropsProfile" name="primaryCrops" class="form-control" placeholder="e.g., Tomatoes, Rice, Mangoes">
                                </div>
                                <button type="submit" class="btn btn-primary">Update Farm Info</button>
                            </form>
                        </div>
                    </div>

                    <!-- Bank Information -->
                    <div class="card">
                        <div style="padding: var(--spacing-lg); border-bottom: 1px solid var(--medium-gray);">
                            <h3>üè¶ Bank Information</h3>
                        </div>
                        <div style="padding: var(--spacing-lg);">
                            <form id="bankInfoForm">
                                <div class="form-group">
                                    <label for="bankName">Bank Name</label>
                                    <input type="text" id="bankName" name="bankName" class="form-control">
                                </div>
                                <div class="form-group">
                                    <label for="accountNumber">Account Number</label>
                                    <input type="text" id="accountNumber" name="accountNumber" class="form-control">
                                </div>
                                <div class="form-group">
                                    <label for="accountHolder">Account Holder Name</label>
                                    <input type="text" id="accountHolder" name="accountHolder" class="form-control">
                                </div>
                                <div class="form-group">
                                    <label for="branchCode">Branch Code</label>
                                    <input type="text" id="branchCode" name="branchCode" class="form-control">
                                </div>
                                <button type="submit" class="btn btn-primary">Update Bank Info</button>
                            </form>
                        </div>
                    </div>

                    <!-- Account Settings -->
                    <div class="card">
                        <div style="padding: var(--spacing-lg); border-bottom: 1px solid var(--medium-gray);">
                            <h3>‚öôÔ∏è Account Settings</h3>
                        </div>
                        <div style="padding: var(--spacing-lg);">
                            <div class="form-group">
                                <label style="display: flex; align-items: center; gap: var(--spacing-xs);">
                                    <input type="checkbox" id="emailNotifications"> Email Notifications
                                </label>
                                <div class="form-text">Receive email updates for orders and deliveries</div>
                            </div>
                            <div class="form-group">
                                <label style="display: flex; align-items: center; gap: var(--spacing-xs);">
                                    <input type="checkbox" id="smsNotifications"> SMS Notifications
                                </label>
                                <div class="form-text">Receive SMS alerts for urgent updates</div>
                            </div>
                            <div class="form-group">
                                <label style="display: flex; align-items: center; gap: var(--spacing-xs);">
                                    <input type="checkbox" id="organicCertified"> Organic Certified Farm
                                </label>
                                <div class="form-text">Mark your farm as organic certified</div>
                            </div>
                            <button class="btn btn-primary">Save Settings</button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Analytics -->
            <div id="analytics-section" class="content-section" style="display: none;">
                <h1 style="margin-bottom: var(--spacing-lg);">üìà Analytics & Insights</h1>

                <!-- Analytics Cards -->
                <div class="dashboard-stats">
                    <div class="stat-card">
                        <div class="stat-number" id="totalSales">0</div>
                        <div class="stat-label">Total Sales (kg)</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="avgRating">0.0</div>
                        <div class="stat-label">Average Rating</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="repeatCustomers">0</div>
                        <div class="stat-label">Repeat Customers</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="conversionRate">0%</div>
                        <div class="stat-label">Order Conversion</div>
                    </div>
                </div>

                <!-- Analytics Charts Placeholders -->
                <div class="grid grid-2" style="margin-top: var(--spacing-xl);">
                    <div class="card">
                        <div style="padding: var(--spacing-lg); border-bottom: 1px solid var(--medium-gray);">
                            <h3>üîù Top Selling Products</h3>
                        </div>
                        <div style="padding: var(--spacing-xl); text-align: center; color: var(--dark-gray);">
                            <div style="font-size: 3rem; margin-bottom: var(--spacing-md);">üìä</div>
                            <p>Product performance chart</p>
                        </div>
                    </div>

                    <div class="card">
                        <div style="padding: var(--spacing-lg); border-bottom: 1px solid var(--medium-gray);">
                            <h3>üìÖ Seasonal Trends</h3>
                        </div>
                        <div style="padding: var(--spacing-xl); text-align: center; color: var(--dark-gray);">
                            <div style="font-size: 3rem; margin-bottom: var(--spacing-md);">üìà</div>
                            <p>Seasonal sales patterns</p>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- Add Product Modal -->
    <div id="addProductModal" class="modal">
        <div class="modal-content" style="max-width: 600px;">
            <div class="modal-header">
                <h3>‚ûï Add New Product</h3>
                <button class="modal-close">&times;</button>
            </div>
            <div class="modal-body">
                <form id="addProductForm">
                    <div class="grid grid-2">
                        <div class="form-group">
                            <label for="productName">Product Name *</label>
                            <input type="text" id="productName" name="name" class="form-control" required>
                        </div>
                        <div class="form-group">
                            <label for="productCategory">Category *</label>
                            <select id="productCategory" name="category" class="form-control" required>
                                <option value="">Select Category</option>
                                <option value="vegetables">ü•¨ Vegetables</option>
                                <option value="fruits">üçé Fruits</option>
                                <option value="grains">üåæ Grains</option>
                                <option value="spices">üå∂Ô∏è Spices</option>
                                <option value="herbs">üåø Herbs</option>
                                <option value="legumes">ü´ò Legumes</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="productDescription">Description</label>
                        <textarea id="productDescription" name="description" class="form-control" rows="3"></textarea>
                    </div>
                    
                    <div class="grid grid-2">
                        <div class="form-group">
                            <label for="productPrice">Price per kg (Rs.) *</label>
                            <input type="number" id="productPrice" name="price" class="form-control" step="0.50" min="0" required>
                        </div>
                        <div class="form-group">
                            <label for="productStock">Stock (kg) *</label>
                            <input type="number" id="productStock" name="stock" class="form-control" step="0.1" min="0" required>
                        </div>
                    </div>
                    
                    <div class="grid grid-2">
                        <div class="form-group">
                            <label for="harvestDate">Harvest Date</label>
                            <input type="date" id="harvestDate" name="harvestDate" class="form-control">
                        </div>
                        <div class="form-group">
                            <label for="expiryDate">Best Before Date</label>
                            <input type="date" id="expiryDate" name="expiryDate" class="form-control">
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label style="display: flex; align-items: center; gap: var(--spacing-xs);">
                            <input type="checkbox" name="organic" value="1"> Organic Product
                        </label>
                    </div>
                    
                    <div style="display: flex; gap: var(--spacing-md); margin-top: var(--spacing-lg);">
                        <button type="submit" class="btn btn-primary">Add Product</button>
                        <button type="button" class="btn btn-secondary" data-modal-close>Cancel</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <script src="assets/js/main.js"></script>
    <script>
        // Remove authentication check to allow dashboard access without login
        document.addEventListener('DOMContentLoaded', function() {
            initFarmerDashboard();
        });

        // Initialize farmer dashboard
        function initFarmerDashboard() {
            const user = getCurrentUser?.();
            if (user && document.getElementById('farmerName')) {
                document.getElementById('farmerName').textContent = user.name || 'Farmer';
            } else if (document.getElementById('farmerName')) {
                document.getElementById('farmerName').textContent = 'Farmer';
            }
            
            loadDashboardData();
            loadProducts();
            loadOrders();
            loadEarnings();
            loadDeliveries();
            loadProfile();
            
            // Set up navigation
            setupNavigation();
            
            // Set up forms
            setupForms();
        }

        // Navigation setup
        function setupNavigation() {
            const menuLinks = document.querySelectorAll('.menu-link');
            menuLinks.forEach(link => {
                link.addEventListener('click', function(e) {
                    e.preventDefault();
                    const section = this.getAttribute('data-section');
                    showSection(section);
                    
                    // Update active menu item
                    menuLinks.forEach(l => l.classList.remove('active'));
                    this.classList.add('active');
                });
            });
        }

        // Show specific section
        function showSection(sectionName) {
            // Hide all sections
            const sections = document.querySelectorAll('.content-section');
            sections.forEach(section => section.style.display = 'none');
            
            // Show selected section
            const targetSection = document.getElementById(sectionName + '-section');
            if (targetSection) {
                targetSection.style.display = 'block';
            }
            
            // Update active menu
            const menuLinks = document.querySelectorAll('.menu-link');
            menuLinks.forEach(link => {
                link.classList.remove('active');
                if (link.getAttribute('data-section') === sectionName) {
                    link.classList.add('active');
                }
            });
        }

        // Load dashboard data
        function loadDashboardData() {
            // Mock data - in real app, fetch from API
            const products = getFarmerProducts();
            const orders = getFarmerOrders();
            const earnings = calculateEarnings(orders);
            
            document.getElementById('totalProducts').textContent = products.length;
            document.getElementById('pendingOrders').textContent = orders.filter(o => o.status === 'pending').length;
            document.getElementById('monthlyEarnings').textContent = `Rs. ${earnings.monthly.toFixed(2)}`;
            document.getElementById('totalEarnings').textContent = `Rs. ${earnings.total.toFixed(2)}`;
            
            // Load recent orders
            const recentOrders = orders.slice(0, 5);
            document.getElementById('recentOrders').innerHTML = recentOrders.length ? 
                recentOrders.map(order => `
                    <div style="margin-bottom: var(--spacing-sm); padding-bottom: var(--spacing-sm); border-bottom: 1px solid var(--light-gray);">
                        <div style="font-weight: var(--font-weight-bold);">#${order.id}</div>
                        <div style="font-size: 0.9rem; color: var(--dark-gray);">${order.buyer} - Rs. ${order.total}</div>
                        <span class="badge badge-${order.status === 'pending' ? 'warning' : 'success'}">${order.status}</span>
                    </div>
                `).join('') : '<p class="text-muted">No recent orders</p>';
            
            // Load top products
            const topProducts = products.slice(0, 5);
            document.getElementById('topProducts').innerHTML = topProducts.length ?
                topProducts.map(product => `
                    <div style="margin-bottom: var(--spacing-sm); padding-bottom: var(--spacing-sm); border-bottom: 1px solid var(--light-gray);">
                        <div style="font-weight: var(--font-weight-bold);">${product.name}</div>
                        <div style="font-size: 0.9rem; color: var(--dark-gray);">Rs. ${product.price}/kg - ${product.stock}kg available</div>
                        <span class="badge badge-${product.status === 'available' ? 'success' : 'warning'}">${product.status}</span>
                    </div>
                `).join('') : '<p class="text-muted">No products listed</p>';
        }

        // Get farmer products (mock data)
        function getFarmerProducts() {
            const farmerProducts = JSON.parse(localStorage.getItem('farmer_products')) || [];
            if (farmerProducts.length === 0) {
                // Add some sample products
                const sampleProducts = [
                    {
                        id: generateId(),
                        name: 'Fresh Tomatoes',
                        category: 'vegetables',
                        price: 120,
                        stock: 50,
                        status: 'available',
                        harvestDate: '2025-01-05',
                        description: 'Fresh organic tomatoes',
                        organic: true
                    }
                ];
                localStorage.setItem('farmer_products', JSON.stringify(sampleProducts));
                return sampleProducts;
            }
            return farmerProducts;
        }

        // Get farmer orders (mock data)
        function getFarmerOrders() {
            const orders = JSON.parse(localStorage.getItem('agrolink_orders')) || [];
            return orders.map(order => ({
                ...order,
                buyer: order.customer?.firstName + ' ' + order.customer?.lastName || 'Anonymous',
                status: order.status || 'pending'
            }));
        }

        // Calculate earnings
        function calculateEarnings(orders) {
            const now = new Date();
            const thisMonth = orders.filter(order => {
                const orderDate = new Date(order.orderDate);
                return orderDate.getMonth() === now.getMonth() && orderDate.getFullYear() === now.getFullYear();
            });
            
            return {
                monthly: thisMonth.reduce((sum, order) => sum + (order.total || 0), 0),
                total: orders.reduce((sum, order) => sum + (order.total || 0), 0)
            };
        }

        // Load products table
        function loadProducts() {
            const products = getFarmerProducts();
            const tbody = document.getElementById('productsTableBody');
            
            tbody.innerHTML = products.map(product => `
                <tr>
                    <td>
                        <div style="font-weight: var(--font-weight-bold);">${product.name}</div>
                        <div style="font-size: 0.9rem; color: var(--dark-gray);">${product.description || 'No description'}</div>
                    </td>
                    <td><span class="badge badge-info">${product.category}</span></td>
                    <td>Rs. ${product.price}</td>
                    <td>${product.stock} kg</td>
                    <td><span class="badge badge-${product.status === 'available' ? 'success' : 'warning'}">${product.status}</span></td>
                    <td>${product.harvestDate || 'Not set'}</td>
                    <td>
                        <button class="btn btn-sm btn-secondary" onclick="editProduct('${product.id}')">Edit</button>
                        <button class="btn btn-sm btn-danger" onclick="deleteProduct('${product.id}')">Delete</button>
                    </td>
                </tr>
            `).join('');
        }
   // Setup forms
        function setupForms() {
            // Add product form
            const addProductForm = document.getElementById('addProductForm');
            if (addProductForm) {
                addProductForm.addEventListener('submit', function(e) {
                    e.preventDefault();
                    
                    const formData = new FormData(this);
                    const productData = {
                        id: generateId(),
                        name: formData.get('name'),
                        category: formData.get('category'),
                        description: formData.get('description'),
                        price: parseFloat(formData.get('price')),
                        stock: parseFloat(formData.get('stock')),
                        harvestDate: formData.get('harvestDate'),
                        expiryDate: formData.get('expiryDate'),
                        organic: formData.get('organic') === '1',
                        status: 'available',
                        createdAt: new Date().toISOString()
                    };
                    
                    const products = getFarmerProducts();
                    products.push(productData);
                    localStorage.setItem('farmer_products', JSON.stringify(products));
                    
                    showNotification?.('Product added successfully!', 'success');
                    closeModal?.('addProductModal');
                    this.reset();
                    loadProducts();
                    loadDashboardData();
                });
            }
        }
        // Mock functions for orders, earnings, deliveries, profile
        function loadOrders() {
            const orders = getFarmerOrders();
            const tbody = document.getElementById('ordersTableBody');
            
            tbody.innerHTML = orders.length ? orders.map(order => `
                <tr>
                    <td>#${order.id}</td>
                    <td>${order.buyer}</td>
                    <td>${order.items?.length || 0} items</td>
                    <td>Rs. ${order.total?.toFixed(2) || '0.00'}</td>
                    <td><span class="badge badge-${order.status === 'pending' ? 'warning' : 'success'}">${order.status}</span></td>
                    <td>${order.orderDate ? new Date(order.orderDate).toLocaleDateString() : ''}</td>
                    <td>
                        <button class="btn btn-sm btn-primary" onclick="viewOrder('${order.id}')">View</button>
                        ${order.status === 'pending' ? '<button class="btn btn-sm btn-success" onclick="acceptOrder(\'' + order.id + '\')">Accept</button>' : ''}
                    </td>
                </tr>
            `).join('') : '<tr><td colspan="7" class="text-center text-muted">No orders found</td></tr>';
        }

        function loadEarnings() {
            // Mock earnings data
            document.getElementById('todayEarnings').textContent = 'Rs. 2,450';
            document.getElementById('weekEarnings').textContent = 'Rs. 15,600';
            document.getElementById('monthEarningsDetail').textContent = 'Rs. 45,200';
            document.getElementById('yearEarnings').textContent = 'Rs. 180,500';
        }

        function loadDeliveries() {
            // Mock delivery data
            document.getElementById('pendingDeliveries').textContent = '3';
            document.getElementById('inTransitDeliveries').textContent = '2';
            document.getElementById('completedDeliveries').textContent = '45';
            document.getElementById('avgDeliveryTime').textContent = '2.3';
            
            const tbody = document.getElementById('deliveriesTableBody');
            tbody.innerHTML = '<tr><td colspan="7" class="text-center text-muted">No deliveries found</td></tr>';
        }

        function loadProfile() {
            const user = getCurrentUser?.();
            if (user) {
                if (document.getElementById('profileName')) document.getElementById('profileName').value = user.name || '';
                if (document.getElementById('profileEmail')) document.getElementById('profileEmail').value = user.email || '';
                if (document.getElementById('profilePhone')) document.getElementById('profilePhone').value = user.phone || '';
            }
        }

        // Product management functions
        function editProduct(productId) {
            showNotification?.('Edit product functionality will be implemented', 'info');
        }

        function deleteProduct(productId) {
            if (confirm('Are you sure you want to delete this product?')) {
                const products = getFarmerProducts();
                const updatedProducts = products.filter(p => p.id !== productId);
                localStorage.setItem('farmer_products', JSON.stringify(updatedProducts));
                showNotification?.('Product deleted successfully!', 'success');
                loadProducts();
                loadDashboardData();
            }
        }

        // Order management functions
        function viewOrder(orderId) {
            showNotification?.('Order details modal will be implemented', 'info');
        }

        function acceptOrder(orderId) {
            showNotification?.('Order accepted! Buyer will be notified.', 'success');
        }

        // Export functions
        function exportSalesData(period) {
            showNotification?.(`Exporting ${period} sales data...`, 'info');
            // In real app, generate and download CSV
        }

        // Utility: Generate random ID
        function generateId() {
            return 'id-' + Math.random().toString(36).substr(2, 9);
        }

        // Utility: Dummy getCurrentUser if not defined
        if (typeof getCurrentUser !== 'function') {
            function getCurrentUser() {
                return null;
            }
        }

        // Utility: Dummy showNotification if not defined
        if (typeof showNotification !== 'function') {
            function showNotification(msg, type) {
                alert(msg);
            }
        }

        // Utility: Dummy closeModal if not defined
        if (typeof closeModal !== 'function') {
            function closeModal(modalId) {
                const modal = document.getElementById(modalId);
                if (modal) modal.style.display = 'none';
            }
        }
    </script>
</body>
</html>
