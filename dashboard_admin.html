<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Dashboard - AgroLink</title>
    <link rel="stylesheet" href="assets/css/style.css">
</head>
<body>
    <!-- Header -->
    <header class="header">
        <nav class="nav container">
            <div class="logo">
                <img src="assets/img/Logo.png" alt="AgroLink" style="height: 40px;">
            </div>
            <div class="nav-actions">
                <div class="user-info">
                    <span>Welcome, <span id="adminName">Admin</span></span>
                    <button onclick="logout()" class="btn btn-sm">Logout</button>
                </div>
            </div>
        </nav>
    </header>

    <!-- Dashboard Layout -->
    <div class="dashboard">
        <!-- Sidebar -->
        <aside class="sidebar">
            <h3 style="margin-bottom: var(--spacing-lg); color: var(--primary-green);">üõ†Ô∏è Admin Dashboard</h3>
            <ul class="sidebar-menu">
                <li><a href="#dashboard" class="menu-link active" data-section="dashboard">üìä Dashboard</a></li>
                <li><a href="#users" class="menu-link" data-section="users">üë• User Management</a></li>
                <li><a href="#orders" class="menu-link" data-section="orders">üì¶ Order Management</a></li>
                <li><a href="#products" class="menu-link" data-section="products">üåæ Product Management</a></li>
                <li><a href="#payments" class="menu-link" data-section="payments">üí≥ Payments & Finance</a></li>
                <li><a href="#disputes" class="menu-link" data-section="disputes">‚öñÔ∏è Disputes</a></li>
                <li><a href="#analytics" class="menu-link" data-section="analytics">üìà Analytics</a></li>
                <li><a href="#notifications" class="menu-link" data-section="notifications">üì¢ Notifications</a></li>
                <li><a href="#settings" class="menu-link" data-section="settings">‚öôÔ∏è Settings</a></li>
            </ul>
        </aside>

        <!-- Main Content -->
        <main class="main-content">
            <!-- Dashboard Overview -->
            <div id="dashboard-section" class="content-section">
                <h1 style="margin-bottom: var(--spacing-lg);">System Overview</h1>
                
                <!-- Key Metrics -->
                <div class="dashboard-stats">
                    <div class="stat-card">
                        <div class="stat-number" id="totalUsers">0</div>
                        <div class="stat-label">Total Users</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="activeOrders">0</div>
                        <div class="stat-label">Active Orders</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="totalRevenue">Rs. 0</div>
                        <div class="stat-label">Total Revenue</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="systemHealth">98%</div>
                        <div class="stat-label">System Health</div>
                    </div>
                </div>

                <!-- User Distribution -->
                <div class="grid grid-4" style="margin-top: var(--spacing-xl);">
                    <div class="card text-center">
                        <div style="padding: var(--spacing-lg);">
                            <div style="font-size: 2.5rem; margin-bottom: var(--spacing-sm);">üë®‚Äçüåæ</div>
                            <div style="font-size: 1.5rem; font-weight: var(--font-weight-bold); color: var(--primary-green);" id="farmerCount">0</div>
                            <div style="color: var(--dark-gray);">Farmers</div>
                        </div>
                    </div>
                    <div class="card text-center">
                        <div style="padding: var(--spacing-lg);">
                            <div style="font-size: 2.5rem; margin-bottom: var(--spacing-sm);">üõí</div>
                            <div style="font-size: 1.5rem; font-weight: var(--font-weight-bold); color: var(--primary-green);" id="buyerCount">0</div>
                            <div style="color: var(--dark-gray);">Buyers</div>
                        </div>
                    </div>
                    <div class="card text-center">
                        <div style="padding: var(--spacing-lg);">
                            <div style="font-size: 2.5rem; margin-bottom: var(--spacing-sm);">üöö</div>
                            <div style="font-size: 1.5rem; font-weight: var(--font-weight-bold); color: var(--primary-green);" id="transporterCount">0</div>
                            <div style="color: var(--dark-gray);">Transporters</div>
                        </div>
                    </div>
                    <div class="card text-center">
                        <div style="padding: var(--spacing-lg);">
                            <div style="font-size: 2.5rem; margin-bottom: var(--spacing-sm);">üëë</div>
                            <div style="font-size: 1.5rem; font-weight: var(--font-weight-bold); color: var(--primary-green);" id="adminCount">0</div>
                            <div style="color: var(--dark-gray);">Admins</div>
                        </div>
                    </div>
                </div>

                <!-- Recent Activity -->
                <div class="grid grid-2" style="margin-top: var(--spacing-xl);">
                    <div class="card">
                        <div style="padding: var(--spacing-lg); border-bottom: 1px solid var(--medium-gray);">
                            <h3>üìã Recent Orders</h3>
                        </div>
                        <div id="recentOrders" style="padding: var(--spacing-lg);">
                            <!-- Recent orders will be populated by JavaScript -->
                        </div>
                    </div>
                    
                    <div class="card">
                        <div style="padding: var(--spacing-lg); border-bottom: 1px solid var(--medium-gray);">
                            <h3>üë• New User Registrations</h3>
                        </div>
                        <div id="newRegistrations" style="padding: var(--spacing-lg);">
                            <!-- New registrations will be populated by JavaScript -->
                        </div>
                    </div>
                </div>

                <!-- System Alerts -->
                <div class="card" style="margin-top: var(--spacing-xl);">
                    <div style="padding: var(--spacing-lg); border-bottom: 1px solid var(--medium-gray);">
                        <h3>üö® System Alerts</h3>
                    </div>
                    <div id="systemAlerts" style="padding: var(--spacing-lg);">
                        <div class="notification warning">
                            <strong>Payment Gateway:</strong> Sandbox mode is active. Real payments are disabled.
                        </div>
                        <div class="notification success">
                            <strong>Database:</strong> All systems operational.
                        </div>
                        <div class="notification info">
                            <strong>Backup:</strong> Last backup completed 2 hours ago.
                        </div>
                    </div>
                </div>
            </div>

            <!-- User Management -->
            <div id="users-section" class="content-section" style="display: none;">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: var(--spacing-lg);">
                    <h1>üë• User Management</h1>
                    <div style="display: flex; gap: var(--spacing-sm);">
                        <button class="btn btn-secondary" onclick="exportUsers()">üì• Export Users</button>
                        <button class="btn btn-primary" data-modal="addUserModal">‚ûï Add User</button>
                    </div>
                </div>

                <!-- User Filters -->
                <div class="filters">
                    <div class="filters-row">
                        <div class="filter-group">
                            <label for="userSearch">Search Users</label>
                            <input type="text" id="userSearch" class="form-control" placeholder="Search by name, email, or ID...">
                        </div>
                        <div class="filter-group">
                            <label for="roleFilter">Role</label>
                            <select id="roleFilter" class="form-control">
                                <option value="">All Roles</option>
                                <option value="farmer">Farmers</option>
                                <option value="buyer">Buyers</option>
                                <option value="transporter">Transporters</option>
                                <option value="admin">Admins</option>
                            </select>
                        </div>
                        <div class="filter-group">
                            <label for="statusFilter">Status</label>
                            <select id="statusFilter" class="form-control">
                                <option value="">All Status</option>
                                <option value="active">Active</option>
                                <option value="pending">Pending Approval</option>
                                <option value="suspended">Suspended</option>
                                <option value="banned">Banned</option>
                            </select>
                        </div>
                        <div class="filter-group">
                            <label for="locationUserFilter">Location</label>
                            <select id="locationUserFilter" class="form-control">
                                <option value="">All Locations</option>
                                <option value="Colombo">Colombo</option>
                                <option value="Kandy">Kandy</option>
                                <option value="Galle">Galle</option>
                                <option value="Matale">Matale</option>
                            </select>
                        </div>
                    </div>
                </div>

                <!-- Users Table -->
                <div class="table-container">
                    <table class="table">
                        <thead>
                            <tr>
                                <th data-sort="id">User ID</th>
                                <th data-sort="name">Name</th>
                                <th data-sort="email">Email</th>
                                <th data-sort="role">Role</th>
                                <th data-sort="location">Location</th>
                                <th data-sort="status">Status</th>
                                <th data-sort="created">Registration Date</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="usersTableBody">
                            <!-- Users will be populated by JavaScript -->
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Order Management -->
            <div id="orders-section" class="content-section" style="display: none;">
                <h1 style="margin-bottom: var(--spacing-lg);">üì¶ Order Management</h1>

                <!-- Order Statistics -->
                <div class="dashboard-stats">
                    <div class="stat-card">
                        <div class="stat-number" id="pendingOrdersCount">0</div>
                        <div class="stat-label">Pending Orders</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="processingOrdersCount">0</div>
                        <div class="stat-label">Processing</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="completedOrdersCount">0</div>
                        <div class="stat-label">Completed</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="averageOrderValue">Rs. 0</div>
                        <div class="stat-label">Avg Order Value</div>
                    </div>
                </div>

                <!-- Order Filters -->
                <div class="filters" style="margin-top: var(--spacing-xl);">
                    <div class="filters-row">
                        <div class="filter-group">
                            <label for="orderSearch">Search Orders</label>
                            <input type="text" id="orderSearch" class="form-control" placeholder="Search by order ID, buyer, or farmer...">
                        </div>
                        <div class="filter-group">
                            <label for="orderStatusFilter">Status</label>
                            <select id="orderStatusFilter" class="form-control">
                                <option value="">All Status</option>
                                <option value="pending">Pending</option>
                                <option value="confirmed">Confirmed</option>
                                <option value="processing">Processing</option>
                                <option value="shipped">Shipped</option>
                                <option value="delivered">Delivered</option>
                                <option value="cancelled">Cancelled</option>
                            </select>
                        </div>
                        <div class="filter-group">
                            <label for="orderDateFilter">Date Range</label>
                            <select id="orderDateFilter" class="form-control">
                                <option value="">All Time</option>
                                <option value="today">Today</option>
                                <option value="week">This Week</option>
                                <option value="month">This Month</option>
                                <option value="quarter">This Quarter</option>
                            </select>
                        </div>
                        <div class="filter-group">
                            <label for="paymentStatusFilter">Payment</label>
                            <select id="paymentStatusFilter" class="form-control">
                                <option value="">All Payments</option>
                                <option value="paid">Paid</option>
                                <option value="pending">Pending</option>
                                <option value="failed">Failed</option>
                                <option value="refunded">Refunded</option>
                            </select>
                        </div>
                    </div>
                </div>

                <!-- Orders Table -->
                <div class="table-container">
                    <table class="table">
                        <thead>
                            <tr>
                                <th data-sort="id">Order ID</th>
                                <th data-sort="buyer">Buyer</th>
                                <th data-sort="farmer">Farmer</th>
                                <th data-sort="total">Total</th>
                                <th data-sort="status">Status</th>
                                <th data-sort="payment">Payment</th>
                                <th data-sort="date">Date</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="ordersTableBody">
                            <!-- Orders will be populated by JavaScript -->
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Product Management -->
            <div id="products-section" class="content-section" style="display: none;">
                <h1 style="margin-bottom: var(--spacing-lg);">üåæ Product Management</h1>

                <!-- Product Statistics -->
                <div class="dashboard-stats">
                    <div class="stat-card">
                        <div class="stat-number" id="totalProducts">0</div>
                        <div class="stat-label">Total Products</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="activeProducts">0</div>
                        <div class="stat-label">Active Products</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="outOfStock">0</div>
                        <div class="stat-label">Out of Stock</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="pendingApproval">0</div>
                        <div class="stat-label">Pending Approval</div>
                    </div>
                </div>

                <!-- Product Categories -->
                <div class="grid grid-3" style="margin-top: var(--spacing-xl);">
                    <div class="card text-center">
                        <div style="padding: var(--spacing-lg);">
                            <div style="font-size: 2rem; margin-bottom: var(--spacing-sm);">ü•¨</div>
                            <h4>Vegetables</h4>
                            <div style="font-size: 1.2rem; color: var(--primary-green);" id="vegetableCount">0</div>
                        </div>
                    </div>
                    <div class="card text-center">
                        <div style="padding: var(--spacing-lg);">
                            <div style="font-size: 2rem; margin-bottom: var(--spacing-sm);">üçé</div>
                            <h4>Fruits</h4>
                            <div style="font-size: 1.2rem; color: var(--primary-green);" id="fruitCount">0</div>
                        </div>
                    </div>
                    <div class="card text-center">
                        <div style="padding: var(--spacing-lg);">
                            <div style="font-size: 2rem; margin-bottom: var(--spacing-sm);">üåæ</div>
                            <h4>Grains</h4>
                            <div style="font-size: 1.2rem; color: var(--primary-green);" id="grainCount">0</div>
                        </div>
                    </div>
                </div>

                <!-- Products Table -->
                <div class="table-container" style="margin-top: var(--spacing-xl);">
                    <table class="table">
                        <thead>
                            <tr>
                                <th>Product</th>
                                <th>Farmer</th>
                                <th>Category</th>
                                <th>Price</th>
                                <th>Stock</th>
                                <th>Status</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="productsTableBody">
                            <!-- Products will be populated by JavaScript -->
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Payments & Finance -->
            <div id="payments-section" class="content-section" style="display: none;">
                <h1 style="margin-bottom: var(--spacing-lg);">üí≥ Payments & Finance</h1>

                <!-- Financial Overview -->
                <div class="dashboard-stats">
                    <div class="stat-card">
                        <div class="stat-number" id="totalTransactions">0</div>
                        <div class="stat-label">Total Transactions</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="successfulPayments">0</div>
                        <div class="stat-label">Successful Payments</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="pendingPayments">0</div>
                        <div class="stat-label">Pending Payments</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="platformCommission">Rs. 0</div>
                        <div class="stat-label">Platform Commission</div>
                    </div>
                </div>

                <!-- Payment Methods -->
                <div class="grid grid-4" style="margin-top: var(--spacing-xl);">
                    <div class="card text-center">
                        <div style="padding: var(--spacing-lg);">
                            <div style="font-size: 2rem; margin-bottom: var(--spacing-sm);">üíµ</div>
                            <h4>Cash on Delivery</h4>
                            <div style="font-size: 1.2rem; color: var(--primary-green);">65%</div>
                        </div>
                    </div>
                    <div class="card text-center">
                        <div style="padding: var(--spacing-lg);">
                            <div style="font-size: 2rem; margin-bottom: var(--spacing-sm);">üè¶</div>
                            <h4>Bank Transfer</h4>
                            <div style="font-size: 1.2rem; color: var(--primary-green);">20%</div>
                        </div>
                    </div>
                    <div class="card text-center">
                        <div style="padding: var(--spacing-lg);">
                            <div style="font-size: 2rem; margin-bottom: var(--spacing-sm);">üì±</div>
                            <h4>Mobile Payment</h4>
                            <div style="font-size: 1.2rem; color: var(--primary-green);">10%</div>
                        </div>
                    </div>
                    <div class="card text-center">
                        <div style="padding: var(--spacing-lg);">
                            <div style="font-size: 2rem; margin-bottom: var(--spacing-sm);">üí≥</div>
                            <h4>Credit/Debit</h4>
                            <div style="font-size: 1.2rem; color: var(--primary-green);">5%</div>
                        </div>
                    </div>
                </div>

                <!-- Recent Transactions -->
                <div class="card" style="margin-top: var(--spacing-xl);">
                    <div style="padding: var(--spacing-lg); border-bottom: 1px solid var(--medium-gray);">
                        <div style="display: flex; justify-content: space-between; align-items: center;">
                            <h3>üí∞ Recent Transactions</h3>
                            <button class="btn btn-secondary" onclick="exportTransactions()">üì• Export</button>
                        </div>
                    </div>
                    <div style="padding: var(--spacing-lg);">
                        <div class="table-container">
                            <table class="table">
                                <thead>
                                    <tr>
                                        <th>Transaction ID</th>
                                        <th>Order ID</th>
                                        <th>Amount</th>
                                        <th>Method</th>
                                        <th>Status</th>
                                        <th>Date</th>
                                        <th>Actions</th>
                                    </tr>
                                </thead>
                                <tbody id="transactionsTableBody">
                                    <!-- Transactions will be populated by JavaScript -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Disputes -->
            <div id="disputes-section" class="content-section" style="display: none;">
                <h1 style="margin-bottom: var(--spacing-lg);">‚öñÔ∏è Disputes Management</h1>

                <!-- Dispute Statistics -->
                <div class="dashboard-stats">
                    <div class="stat-card">
                        <div class="stat-number" id="totalDisputes">0</div>
                        <div class="stat-label">Total Disputes</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="openDisputes">0</div>
                        <div class="stat-label">Open Disputes</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="resolvedDisputes">0</div>
                        <div class="stat-label">Resolved</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="averageResolutionTime">0</div>
                        <div class="stat-label">Avg Resolution (days)</div>
                    </div>
                </div>

                <!-- Dispute Categories -->
                <div class="grid grid-3" style="margin-top: var(--spacing-xl);">
                    <div class="card">
                        <div style="padding: var(--spacing-lg); text-align: center;">
                            <h4>üì¶ Order Issues</h4>
                            <div style="font-size: 1.5rem; color: var(--primary-green); margin: var(--spacing-sm) 0;">15</div>
                            <div style="color: var(--dark-gray); font-size: 0.9rem;">Wrong items, missing orders</div>
                        </div>
                    </div>
                    <div class="card">
                        <div style="padding: var(--spacing-lg); text-align: center;">
                            <h4>üí≥ Payment Issues</h4>
                            <div style="font-size: 1.5rem; color: var(--primary-green); margin: var(--spacing-sm) 0;">8</div>
                            <div style="color: var(--dark-gray); font-size: 0.9rem;">Payment failures, refunds</div>
                        </div>
                    </div>
                    <div class="card">
                        <div style="padding: var(--spacing-lg); text-align: center;">
                            <h4>üöö Delivery Issues</h4>
                            <div style="font-size: 1.5rem; color: var(--primary-green); margin: var(--spacing-sm) 0;">12</div>
                            <div style="color: var(--dark-gray); font-size: 0.9rem;">Late delivery, damaged goods</div>
                        </div>
                    </div>
                </div>

                <!-- Disputes Table -->
                <div class="table-container" style="margin-top: var(--spacing-xl);">
                    <table class="table">
                        <thead>
                            <tr>
                                <th>Dispute ID</th>
                                <th>Order ID</th>
                                <th>Complainant</th>
                                <th>Type</th>
                                <th>Priority</th>
                                <th>Status</th>
                                <th>Created</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="disputesTableBody">
                            <tr>
                                <td>#DIS-001</td>
                                <td>#ORD-2025-001</td>
                                <td>John Buyer</td>
                                <td>Order Issue</td>
                                <td><span class="badge badge-danger">High</span></td>
                                <td><span class="badge badge-warning">Open</span></td>
                                <td>2025-01-07</td>
                                <td>
                                    <button class="btn btn-sm btn-primary" onclick="viewDispute('DIS-001')">View</button>
                                    <button class="btn btn-sm btn-success" onclick="resolveDispute('DIS-001')">Resolve</button>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Analytics -->
            <div id="analytics-section" class="content-section" style="display: none;">
                <h1 style="margin-bottom: var(--spacing-lg);">üìà Platform Analytics</h1>

                <!-- Key Performance Indicators -->
                <div class="dashboard-stats">
                    <div class="stat-card">
                        <div class="stat-number" id="monthlyActiveUsers">0</div>
                        <div class="stat-label">Monthly Active Users</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="platformGrowth">0%</div>
                        <div class="stat-label">Growth Rate</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="userRetention">0%</div>
                        <div class="stat-label">User Retention</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="customerSatisfaction">0%</div>
                        <div class="stat-label">Customer Satisfaction</div>
                    </div>
                </div>

                <!-- Analytics Charts -->
                <div class="grid grid-2" style="margin-top: var(--spacing-xl);">
                    <div class="card">
                        <div style="padding: var(--spacing-lg); border-bottom: 1px solid var(--medium-gray);">
                            <h3>üìä User Growth</h3>
                        </div>
                        <div style="padding: var(--spacing-xl); text-align: center; color: var(--dark-gray);">
                            <div style="font-size: 4rem; margin-bottom: var(--spacing-md);">üìà</div>
                            <p>User registration and growth trends over time</p>
                        </div>
                    </div>

                    <div class="card">
                        <div style="padding: var(--spacing-lg); border-bottom: 1px solid var(--medium-gray);">
                            <h3>üí∞ Revenue Trends</h3>
                        </div>
                        <div class="text-center" style="padding: var(--spacing-xl); color: var(--dark-gray);">
                            <div style="font-size: 4rem; margin-bottom: var(--spacing-md);">üíπ</div>
                            <p>Monthly revenue and commission tracking</p>
                        </div>
                    </div>

                    <div class="card">
                        <div style="padding: var(--spacing-lg); border-bottom: 1px solid var(--medium-gray);">
                            <h3>üó∫Ô∏è Geographic Distribution</h3>
                        </div>
                        <div class="text-center" style="padding: var(--spacing-xl); color: var(--dark-gray);">
                            <div style="font-size: 4rem; margin-bottom: var(--spacing-md);">üó∫Ô∏è</div>
                            <p>User distribution across Sri Lankan provinces</p>
                        </div>
                    </div>

                    <div class="card">
                        <div style="padding: var(--spacing-lg); border-bottom: 1px solid var(--medium-gray);">
                            <h3>üì± Platform Usage</h3>
                        </div>
                        <div class="text-center" style="padding: var(--spacing-xl); color: var(--dark-gray);">
                            <div style="font-size: 4rem; margin-bottom: var(--spacing-md);">üì±</div>
                            <p>Daily active users and session analytics</p>
                        </div>
                    </div>
                </div>

                <!-- Top Performers -->
                <div class="grid grid-3" style="margin-top: var(--spacing-xl);">
                    <div class="card">
                        <div style="padding: var(--spacing-lg); border-bottom: 1px solid var(--medium-gray);">
                            <h3>üèÜ Top Farmers</h3>
                        </div>
                        <div style="padding: var(--spacing-lg);">
                            <div style="margin-bottom: var(--spacing-sm);">
                                <div style="font-weight: var(--font-weight-bold);">Ranjith Fernando</div>
                                <div style="color: var(--dark-gray); font-size: 0.9rem;">Rs. 45,200 revenue</div>
                            </div>
                            <div style="margin-bottom: var(--spacing-sm);">
                                <div style="font-weight: var(--font-weight-bold);">Kumari Silva</div>
                                <div style="color: var(--dark-gray); font-size: 0.9rem;">Rs. 38,500 revenue</div>
                            </div>
                        </div>
                    </div>

                    <div class="card">
                        <div style="padding: var(--spacing-lg); border-bottom: 1px solid var(--medium-gray);">
                            <h3>üõí Top Buyers</h3>
                        </div>
                        <div style="padding: var(--spacing-lg);">
                            <div style="margin-bottom: var(--spacing-sm);">
                                <div style="font-weight: var(--font-weight-bold);">Green Valley Restaurant</div>
                                <div style="color: var(--dark-gray); font-size: 0.9rem;">Rs. 28,900 spent</div>
                            </div>
                            <div style="margin-bottom: var(--spacing-sm);">
                                <div style="font-weight: var(--font-weight-bold);">Fresh Market Ltd</div>
                                <div style="color: var(--dark-gray); font-size: 0.9rem;">Rs. 22,150 spent</div>
                            </div>
                        </div>
                    </div>

                    <div class="card">
                        <div style="padding: var(--spacing-lg); border-bottom: 1px solid var(--medium-gray);">
                            <h3>üöö Top Transporters</h3>
                        </div>
                        <div style="padding: var(--spacing-lg);">
                            <div style="margin-bottom: var(--spacing-sm);">
                                <div style="font-weight: var(--font-weight-bold);">Express Delivery Co</div>
                                <div style="color: var(--dark-gray); font-size: 0.9rem;">127 deliveries</div>
                            </div>
                            <div style="margin-bottom: var(--spacing-sm);">
                                <div style="font-weight: var(--font-weight-bold);">Island Transport</div>
                                <div style="color: var(--dark-gray); font-size: 0.9rem;">89 deliveries</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Notifications -->
            <div id="notifications-section" class="content-section" style="display: none;">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: var(--spacing-lg);">
                    <h1>üì¢ System Notifications</h1>
                    <button class="btn btn-primary" data-modal="sendNotificationModal">üì§ Send Notification</button>
                </div>

                <!-- Notification Stats -->
                <div class="dashboard-stats">
                    <div class="stat-card">
                        <div class="stat-number" id="totalNotifications">0</div>
                        <div class="stat-label">Total Sent</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="deliveredNotifications">0</div>
                        <div class="stat-label">Delivered</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="openRate">0%</div>
                        <div class="stat-label">Open Rate</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="clickRate">0%</div>
                        <div class="stat-label">Click Rate</div>
                    </div>
                </div>

                <!-- Recent Notifications -->
                <div class="card" style="margin-top: var(--spacing-xl);">
                    <div style="padding: var(--spacing-lg); border-bottom: 1px solid var(--medium-gray);">
                        <h3>üìã Recent Notifications</h3>
                    </div>
                    <div style="padding: var(--spacing-lg);">
                        <div class="table-container">
                            <table class="table">
                                <thead>
                                    <tr>
                                        <th>Title</th>
                                        <th>Recipient</th>
                                        <th>Type</th>
                                        <th>Status</th>
                                        <th>Sent Date</th>
                                        <th>Actions</th>
                                    </tr>
                                </thead>
                                <tbody id="notificationsTableBody">
                                    <tr>
                                        <td>System Maintenance Notice</td>
                                        <td>All Users</td>
                                        <td><span class="badge badge-warning">System</span></td>
                                        <td><span class="badge badge-success">Delivered</span></td>
                                        <td>2025-01-07</td>
                                        <td>
                                            <button class="btn btn-sm btn-secondary">View</button>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Settings -->
            <div id="settings-section" class="content-section" style="display: none;">
                <h1 style="margin-bottom: var(--spacing-lg);">‚öôÔ∏è System Settings</h1>

                <div class="grid grid-2" style="gap: var(--spacing-xl);">
                    <!-- Platform Settings -->
                    <div class="card">
                        <div style="padding: var(--spacing-lg); border-bottom: 1px solid var(--medium-gray);">
                            <h3>üèõÔ∏è Platform Settings</h3>
                        </div>
                        <div style="padding: var(--spacing-lg);">
                            <form id="platformSettingsForm">
                                <div class="form-group">
                                    <label for="platformName">Platform Name</label>
                                    <input type="text" id="platformName" name="platformName" class="form-control" value="AgroLink">
                                </div>
                                <div class="form-group">
                                    <label for="platformCommission">Platform Commission (%)</label>
                                    <input type="number" id="platformCommission" name="commission" class="form-control" value="5" step="0.1">
                                </div>
                                <div class="form-group">
                                    <label for="minOrderValue">Minimum Order Value (Rs.)</label>
                                    <input type="number" id="minOrderValue" name="minOrderValue" class="form-control" value="500">
                                </div>
                                <div class="form-group">
                                    <label for="deliveryFee">Standard Delivery Fee (Rs.)</label>
                                    <input type="number" id="deliveryFee" name="deliveryFee" class="form-control" value="150">
                                </div>
                                <button type="submit" class="btn btn-primary">Save Platform Settings</button>
                            </form>
                        </div>
                    </div>

                    <!-- Payment Settings -->
                    <div class="card">
                        <div style="padding: var(--spacing-lg); border-bottom: 1px solid var(--medium-gray);">
                            <h3>üí≥ Payment Settings</h3>
                        </div>
                        <div style="padding: var(--spacing-lg);">
                            <form id="paymentSettingsForm">
                                <div class="form-group">
                                    <label style="display: flex; align-items: center; gap: var(--spacing-xs);">
                                        <input type="checkbox" id="enableCOD" checked> Enable Cash on Delivery
                                    </label>
                                </div>
                                <div class="form-group">
                                    <label style="display: flex; align-items: center; gap: var(--spacing-xs);">
                                        <input type="checkbox" id="enableBankTransfer" checked> Enable Bank Transfer
                                    </label>
                                </div>
                                <div class="form-group">
                                    <label style="display: flex; align-items: center; gap: var(--spacing-xs);">
                                        <input type="checkbox" id="enableMobilePayment" checked> Enable Mobile Payment
                                    </label>
                                </div>
                                <div class="form-group">
                                    <label style="display: flex; align-items: center; gap: var(--spacing-xs);">
                                        <input type="checkbox" id="enableCardPayment" checked> Enable Card Payment (Sandbox)
                                    </label>
                                </div>
                                <div class="form-group">
                                    <label for="paymentTimeout">Payment Timeout (minutes)</label>
                                    <input type="number" id="paymentTimeout" name="timeout" class="form-control" value="15">
                                </div>
                                <button type="submit" class="btn btn-primary">Save Payment Settings</button>
                            </form>
                        </div>
                    </div>

                    <!-- Notification Settings -->
                    <div class="card">
                        <div style="padding: var(--spacing-lg); border-bottom: 1px solid var(--medium-gray);">
                            <h3>üìß Notification Settings</h3>
                        </div>
                        <div style="padding: var(--spacing-lg);">
                            <form id="notificationSettingsForm">
                                <div class="form-group">
                                    <label style="display: flex; align-items: center; gap: var(--spacing-xs);">
                                        <input type="checkbox" id="enableEmailNotifications" checked> Email Notifications
                                    </label>
                                </div>
                                <div class="form-group">
                                    <label style="display: flex; align-items: center; gap: var(--spacing-xs);">
                                        <input type="checkbox" id="enableSMSNotifications" checked> SMS Notifications
                                    </label>
                                </div>
                                <div class="form-group">
                                    <label style="display: flex; align-items: center; gap: var(--spacing-xs);">
                                        <input type="checkbox" id="enablePushNotifications" checked> Push Notifications
                                    </label>
                                </div>
                                <div class="form-group">
                                    <label for="supportEmail">Support Email</label>
                                    <input type="email" id="supportEmail" name="supportEmail" class="form-control" value="support@agrolink.lk">
                                </div>
                                <button type="submit" class="btn btn-primary">Save Notification Settings</button>
                            </form>
                        </div>
                    </div>

                    <!-- System Maintenance -->
                    <div class="card">
                        <div style="padding: var(--spacing-lg); border-bottom: 1px solid var(--medium-gray);">
                            <h3>üîß System Maintenance</h3>
                        </div>
                        <div style="padding: var(--spacing-lg);">
                            <div class="form-group">
                                <button class="btn btn-secondary w-full mb-md" onclick="performMaintenance('backup')">üóÑÔ∏è Create System Backup</button>
                            </div>
                            <div class="form-group">
                                <button class="btn btn-secondary w-full mb-md" onclick="performMaintenance('cleanup')">üßπ Clean Database</button>
                            </div>
                            <div class="form-group">
                                <button class="btn btn-secondary w-full mb-md" onclick="performMaintenance('cache')">üíæ Clear Cache</button>
                            </div>
                            <div class="form-group">
                                <button class="btn btn-warning w-full" onclick="performMaintenance('maintenance')">‚ö†Ô∏è Enable Maintenance Mode</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- Add User Modal -->
    <div id="addUserModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>‚ûï Add New User</h3>
                <button class="modal-close">&times;</button>
            </div>
            <div class="modal-body">
                <form id="addUserForm">
                    <div class="grid grid-2">
                        <div class="form-group">
                            <label for="userName">Full Name *</label>
                            <input type="text" id="userName" name="name" class="form-control" required>
                        </div>
                        <div class="form-group">
                            <label for="userEmail">Email *</label>
                            <input type="email" id="userEmail" name="email" class="form-control" required>
                        </div>
                    </div>
                    
                    <div class="grid grid-2">
                        <div class="form-group">
                            <label for="userRole">Role *</label>
                            <select id="userRole" name="role" class="form-control" required>
                                <option value="">Select Role</option>
                                <option value="farmer">Farmer</option>
                                <option value="buyer">Buyer</option>
                                <option value="transporter">Transporter</option>
                                <option value="admin">Admin</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="userPhone">Phone</label>
                            <input type="tel" id="userPhone" name="phone" class="form-control">
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="userLocation">Location</label>
                        <input type="text" id="userLocation" name="location" class="form-control">
                    </div>
                    
                    <div style="display: flex; gap: var(--spacing-md); margin-top: var(--spacing-lg);">
                        <button type="submit" class="btn btn-primary">Add User</button>
                        <button type="button" class="btn btn-secondary" data-modal-close>Cancel</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Send Notification Modal -->
    <div id="sendNotificationModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>üì§ Send Notification</h3>
                <button class="modal-close">&times;</button>
            </div>
            <div class="modal-body">
                <form id="sendNotificationForm">
                    <div class="form-group">
                        <label for="notificationTitle">Title *</label>
                        <input type="text" id="notificationTitle" name="title" class="form-control" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="notificationMessage">Message *</label>
                        <textarea id="notificationMessage" name="message" class="form-control" rows="4" required></textarea>
                    </div>
                    
                    <div class="grid grid-2">
                        <div class="form-group">
                            <label for="notificationRecipient">Recipient *</label>
                            <select id="notificationRecipient" name="recipient" class="form-control" required>
                                <option value="">Select Recipients</option>
                                <option value="all">All Users</option>
                                <option value="farmers">All Farmers</option>
                                <option value="buyers">All Buyers</option>
                                <option value="transporters">All Transporters</option>
                                <option value="admins">All Admins</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="notificationType">Type *</label>
                            <select id="notificationType" name="type" class="form-control" required>
                                <option value="">Select Type</option>
                                <option value="system">System</option>
                                <option value="maintenance">Maintenance</option>
                                <option value="promotion">Promotion</option>
                                <option value="alert">Alert</option>
                            </select>
                        </div>
                    </div>
                    
                    <div style="display: flex; gap: var(--spacing-md); margin-top: var(--spacing-lg);">
                        <button type="submit" class="btn btn-primary">Send Notification</button>
                        <button type="button" class="btn btn-secondary" data-modal-close>Cancel</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <script src="assets/js/main.js"></script>
    <script>
        // Remove authentication check to allow dashboard access without login
        document.addEventListener('DOMContentLoaded', function() {
            initAdminDashboard();
        });

        // Initialize admin dashboard
        function initAdminDashboard() {
            const user = typeof getCurrentUser === 'function' ? getCurrentUser() : null;
            if (user && document.getElementById('adminName')) {
                document.getElementById('adminName').textContent = user.name || 'Admin';
            } else if (document.getElementById('adminName')) {
                document.getElementById('adminName').textContent = 'Admin';
            }
            
            loadDashboardData();
            loadUsers();
            loadOrders();
            loadProducts();
            setupNavigation();
            setupForms();
        }

        // Navigation setup
        function setupNavigation() {
            const menuLinks = document.querySelectorAll('.menu-link');
            menuLinks.forEach(link => {
                link.addEventListener('click', function(e) {
                    e.preventDefault();
                    const section = this.getAttribute('data-section');
                    showSection(section);
                    
                    menuLinks.forEach(l => l.classList.remove('active'));
                    this.classList.add('active');
                });
            });
        }

        // Show specific section
        function showSection(sectionName) {
            const sections = document.querySelectorAll('.content-section');
            sections.forEach(section => section.style.display = 'none');
            
            const targetSection = document.getElementById(sectionName + '-section');
            if (targetSection) {
                targetSection.style.display = 'block';
            }
            
            const menuLinks = document.querySelectorAll('.menu-link');
            menuLinks.forEach(link => {
                link.classList.remove('active');
                if (link.getAttribute('data-section') === sectionName) {
                    link.classList.add('active');
                }
            });

            // Load analytics data when analytics section is shown
            if (sectionName === 'analytics') {
                loadAnalytics();
            }
        }

        // Load dashboard data
        function loadDashboardData() {
            // Mock data - in real app, fetch from APIs
            document.getElementById('totalUsers').textContent = '247';
            document.getElementById('activeOrders').textContent = '18';
            document.getElementById('totalRevenue').textContent = 'Rs. 1,245,500';
            
            // User counts by role
            document.getElementById('farmerCount').textContent = '89';
            document.getElementById('buyerCount').textContent = '134';
            document.getElementById('transporterCount').textContent = '21';
            document.getElementById('adminCount').textContent = '3';
            
            // Recent orders
            document.getElementById('recentOrders').innerHTML = `
                <div style="margin-bottom: var(--spacing-sm); padding-bottom: var(--spacing-sm); border-bottom: 1px solid var(--light-gray);">
                    <div style="font-weight: var(--font-weight-bold);">#ORD-2025-007</div>
                    <div style="font-size: 0.9rem; color: var(--dark-gray);">John Buyer ‚Üí Ranjith Farmer - Rs. 2,450</div>
                    <span class="badge badge-success">Completed</span>
                </div>
                <div style="margin-bottom: var(--spacing-sm); padding-bottom: var(--spacing-sm); border-bottom: 1px solid var(--light-gray);">
                    <div style="font-weight: var(--font-weight-bold);">#ORD-2025-008</div>
                    <div style="font-size: 0.9rem; color: var(--dark-gray);">Green Valley Restaurant ‚Üí Multiple Farmers - Rs. 8,900</div>
                    <span class="badge badge-warning">Processing</span>
                </div>
            `;
            
            // New registrations
            document.getElementById('newRegistrations').innerHTML = `
                <div style="margin-bottom: var(--spacing-sm); padding-bottom: var(--spacing-sm); border-bottom: 1px solid var(--light-gray);">
                    <div style="font-weight: var(--font-weight-bold);">Saman Perera</div>
                    <div style="font-size: 0.9rem; color: var(--dark-gray);">Farmer - Kandy</div>
                    <span class="badge badge-info">Pending Approval</span>
                </div>
                <div style="margin-bottom: var(--spacing-sm); padding-bottom: var(--spacing-sm); border-bottom: 1px solid var(--light-gray);">
                    <div style="font-weight: var(--font-weight-bold);">Fresh Mart Ltd</div>
                    <div style="font-size: 0.9rem; color: var(--dark-gray);">Buyer - Colombo</div>
                    <span class="badge badge-success">Approved</span>
                </div>
            `;
        }

        // Load users data
        function loadUsers() {
            const tbody = document.getElementById('usersTableBody');
            tbody.innerHTML = `
                <tr>
                    <td>#USR-001</td>
                    <td>Ranjith Fernando</td>
                    <td>ranjith@email.com</td>
                    <td><span class="badge badge-success">Farmer</span></td>
                    <td>Matale</td>
                    <td><span class="badge badge-success">Active</span></td>
                    <td>2024-12-15</td>
                    <td>
                        <button class="btn btn-sm btn-secondary" onclick="viewUser('USR-001')">View</button>
                        <button class="btn btn-sm btn-warning" onclick="suspendUser('USR-001')">Suspend</button>
                    </td>
                </tr>
                <tr>
                    <td>#USR-002</td>
                    <td>Kumari Silva</td>
                    <td>kumari@email.com</td>
                    <td><span class="badge badge-info">Buyer</span></td>
                    <td>Colombo</td>
                    <td><span class="badge badge-success">Active</span></td>
                    <td>2024-12-20</td>
                    <td>
                        <button class="btn btn-sm btn-secondary" onclick="viewUser('USR-002')">View</button>
                        <button class="btn btn-sm btn-warning" onclick="suspendUser('USR-002')">Suspend</button>
                    </td>
                </tr>
            `;
        }

        // Load orders data
        function loadOrders() {
            // Order statistics
            document.getElementById('pendingOrdersCount').textContent = '5';
            document.getElementById('processingOrdersCount').textContent = '8';
            document.getElementById('completedOrdersCount').textContent = '234';
            document.getElementById('averageOrderValue').textContent = 'Rs. 1,250';
            
            const tbody = document.getElementById('ordersTableBody');
            tbody.innerHTML = `
                <tr>
                    <td>#ORD-2025-001</td>
                    <td>John Buyer</td>
                    <td>Ranjith Fernando</td>
                    <td>Rs. 2,450</td>
                    <td><span class="badge badge-success">Completed</span></td>
                    <td><span class="badge badge-success">Paid</span></td>
                    <td>2025-01-05</td>
                    <td>
                        <button class="btn btn-sm btn-secondary" onclick="viewOrder('ORD-2025-001')">View</button>
                    </td>
                </tr>
                <tr>
                    <td>#ORD-2025-002</td>
                    <td>Green Valley Restaurant</td>
                    <td>Multiple Farmers</td>
                    <td>Rs. 8,900</td>
                    <td><span class="badge badge-warning">Processing</span></td>
                    <td><span class="badge badge-warning">Pending</span></td>
                    <td>2025-01-07</td>
                    <td>
                        <button class="btn btn-sm btn-secondary" onclick="viewOrder('ORD-2025-002')">View</button>
                    </td>
                </tr>
            `;
        }

        // Load products data
        function loadProducts() {
            // Product statistics
            document.getElementById('totalProducts').textContent = '156';
            document.getElementById('activeProducts').textContent = '142';
            document.getElementById('outOfStock').textContent = '8';
            document.getElementById('pendingApproval').textContent = '6';
            
            // Category counts
            document.getElementById('vegetableCount').textContent = '89';
            document.getElementById('fruitCount').textContent = '34';
            document.getElementById('grainCount').textContent = '23';
            
            const tbody = document.getElementById('productsTableBody');
            tbody.innerHTML = `
                <tr>
                    <td>
                        <div style="font-weight: var(--font-weight-bold);">Fresh Tomatoes</div>
                        <div style="font-size: 0.9rem; color: var(--dark-gray);">Organic tomatoes from Matale</div>
                    </td>
                    <td>Ranjith Fernando</td>
                    <td><span class="badge badge-success">Vegetables</span></td>
                    <td>Rs. 120/kg</td>
                    <td>45kg</td>
                    <td><span class="badge badge-success">Active</span></td>
                    <td>
                        <button class="btn btn-sm btn-secondary" onclick="viewProduct('PROD-001')">View</button>
                        <button class="btn btn-sm btn-warning" onclick="moderateProduct('PROD-001')">Moderate</button>
                    </td>
                </tr>
            `;
        }

        // Setup forms
        function setupForms() {
            // Add user form
            const addUserForm = document.getElementById('addUserForm');
            if (addUserForm) {
                addUserForm.addEventListener('submit', function(e) {
                    e.preventDefault();
                    showNotification?.('User added successfully!', 'success');
                    closeModal?.('addUserModal');
                    this.reset();
                    loadUsers();
                });
            }
            
            // Send notification form
            const sendNotificationForm = document.getElementById('sendNotificationForm');
            if (sendNotificationForm) {
                sendNotificationForm.addEventListener('submit', function(e) {
                    e.preventDefault();
                    showNotification?.('Notification sent successfully!', 'success');
                    closeModal?.('sendNotificationModal');
                    this.reset();
                });
            }
            
            // Settings forms
            const platformSettingsForm = document.getElementById('platformSettingsForm');
            if (platformSettingsForm) {
                platformSettingsForm.addEventListener('submit', function(e) {
                    e.preventDefault();
                    showNotification?.('Platform settings saved successfully!', 'success');
                });
            }
        }

        // Admin-specific functions
        function viewUser(userId) {
            showNotification?.('User details modal will be implemented', 'info');
        }

        function suspendUser(userId) {
            if (confirm('Are you sure you want to suspend this user?')) {
                showNotification?.('User suspended successfully', 'warning');
                loadUsers();
            }
        }

        function viewOrder(orderId) {
            showNotification?.('Order details modal will be implemented', 'info');
        }

        function viewProduct(productId) {
            showNotification?.('Product details modal will be implemented', 'info');
        }

        function moderateProduct(productId) {
            showNotification?.('Product moderation modal will be implemented', 'info');
        }

        function viewDispute(disputeId) {
            showNotification?.('Dispute details modal will be implemented', 'info');
        }

        function resolveDispute(disputeId) {
            if (confirm('Mark this dispute as resolved?')) {
                showNotification?.('Dispute resolved successfully', 'success');
            }
        }

        function exportUsers() {
            showNotification?.('Exporting users data...', 'info');
        }

        function exportTransactions() {
            showNotification?.('Exporting transaction data...', 'info');
        }

        function performMaintenance(type) {
            const actions = {
                'backup': 'Creating system backup...',
                'cleanup': 'Cleaning database...',
                'cache': 'Clearing cache...',
                'maintenance': 'Enabling maintenance mode...'
            };
            
            showNotification?.(actions[type], 'info');
            
            setTimeout(() => {
                showNotification?.(`${type} completed successfully!`, 'success');
            }, 2000);
        }

        // Update analytics data
        function loadAnalytics() {
            document.getElementById('monthlyActiveUsers').textContent = '189';
            document.getElementById('platformGrowth').textContent = '12.5%';
            document.getElementById('userRetention').textContent = '87%';
            document.getElementById('customerSatisfaction').textContent = '94%';
        }

        // Utility: Dummy getCurrentUser if not defined
        if (typeof getCurrentUser !== 'function') {
            function getCurrentUser() {
                return null;
            }
        }

        // Utility: Dummy showNotification if not defined
        if (typeof showNotification !== 'function') {
            function showNotification(msg, type) {
                alert(msg);
            }
        }

        // Utility: Dummy closeModal if not defined
        if (typeof closeModal !== 'function') {
            function closeModal(modalId) {
                const modal = document.getElementById(modalId);
                if (modal) modal.style.display = 'none';
            }
        }
    </script>
</body>
</html>
