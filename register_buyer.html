<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Buyer Registration - AgroLink</title>
    <link rel="stylesheet" href="assets/css/style.css" />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Montserrat:ital,wght@0,100..900;1,100..900&display=swap"
      rel="stylesheet"
    />
    <script src="assets/js/main.js"></script>
  </head>
  <body>
    <div class="split-container">
      <!-- Left: Quote & Image -->
      <div
        class="split-left"
        style="
          background: url('assets/img/registerpage/register1.jpg') center
            center/cover no-repeat;
        "
      >
        <span class="quote-icon">&ldquo;</span>
        <div class="split-left-content">
          <p>
            The best produce comes straight from the source.<br />
            AgroLink connects you to Sri Lankaâ€™s freshest harvests.
          </p>
        </div>
      </div>
      <!-- Right: Registration Form -->
      <div class="split-right">
        <div class="form-box">
          <div style="text-align: right; margin-bottom: 0.5rem">
            <select
              id="registerRoleSelect"
              class="role-switcher"
              aria-label="Register as"
            >
              <option value="" disabled selected hidden>Register as...</option>
              <option value="farmer">Register as Farmer</option>
              <option value="transporter">Register as Transporter</option>
            </select>
          </div>
          <h1>Create AgroLink Account</h1>
          <div class="subtitle">
            Enter your email and password to create your account
          </div>
          <form id="registerBuyerForm" autocomplete="off">
            <div class="form-group">
              <label for="name">Name</label>
              <input
                type="text"
                id="name"
                name="name"
                class="form-control"
                required
                placeholder="Your name"
              />
            </div>
            <div class="form-group">
              <label for="email">Email</label>
              <input
                type="email"
                id="email"
                name="email"
                class="form-control"
                required
                placeholder="you@example.com"
              />
            </div>
            <div class="form-group">
              <label for="password">Password</label>
              <input
                type="password"
                id="password"
                name="password"
                class="form-control"
                required
                placeholder="********"
              />
            </div>
            <button type="submit" class="btn btn-primary btn-large">
              Create Account
            </button>
          </form>
          <div class="or-divider">Or continue with</div>
          <button class="google-btn" type="button" onclick="loginWithGoogle()">
            <img
              src="https://www.svgrepo.com/show/475656/google-color.svg"
              alt="Google"
              class="google-icon"
            />
            Google
          </button>
          <div class="text-center">
            Already have an account?
            <a href="login.html">Sign in here</a>
          </div>
        </div>
      </div>
    </div>
    <script>
      document
        .getElementById("registerRoleSelect")
        .addEventListener("change", function () {
          if (this.value === "farmer") {
            window.location.href = "register_farmer.html";
          } else if (this.value === "transporter") {
            window.location.href = "register_transporter.html";
          }
        });
      function loginWithGoogle() {
        alert("Google login coming soon!");
      }
      document
        .getElementById("registerBuyerForm")
        .addEventListener("submit", function (e) {
          e.preventDefault();
          
          // Get form data
          const formData = new FormData(this);
          const data = Object.fromEntries(formData);
          
          // Add role and required fields
          data.role = 'buyer';
          data.full_name = data.name;
          data.confirm_password = data.password;
          
          console.log('Form data after processing:', data);
          
          // Basic validation
          if (data.password.length < 6) {
            if (typeof showNotification === 'function') {
              showNotification('Password must be at least 6 characters long!', 'error');
            } else {
              alert('Password must be at least 6 characters long!');
            }
            return;
          }
          
          // Show loading state
          const submitBtn = this.querySelector('button[type="submit"]');
          const originalText = submitBtn.textContent;
          submitBtn.textContent = 'Creating Account...';
          submitBtn.disabled = true;
          
          // Send registration request
          console.log('Sending registration data:', data);
          fetch('auth/register.php', {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json',
            },
            body: JSON.stringify(data)
          })
          .then(response => {
            console.log('Response status:', response.status);
            return response.json();
          })
          .then(data => {
            console.log('Response data:', data);
            if (data.success) {
              if (typeof showNotification === 'function') {
                showNotification(data.message, 'success');
              } else {
                alert(data.message);
              }
              
              // Redirect to login page after 2 seconds
              setTimeout(() => {
                window.location.href = 'login.html';
              }, 2000);
            } else {
              if (typeof showNotification === 'function') {
                showNotification(data.message, 'error');
              } else {
                alert(data.message);
              }
            }
          })
          .catch(error => {
            console.error('Error:', error);
            if (typeof showNotification === 'function') {
              showNotification('Registration failed. Please try again.', 'error');
            } else {
              alert('Registration failed. Please try again.');
            }
          })
          .finally(() => {
            // Reset button state
            submitBtn.textContent = originalText;
            submitBtn.disabled = false;
          });
        });
    </script>
  </body>
</html>
